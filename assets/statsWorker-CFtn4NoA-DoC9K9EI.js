(function(){"use strict";const Zt=["selfBuffs","groupBuffs","squadBuffs"],yt=i=>i!=null&&i.classification?i.classification==="Boon":!0,en=i=>`b${i}`,Hn=(i,m)=>{const S=Array.isArray(i==null?void 0:i.activeTimes)?i.activeTimes:[],z=typeof S[0]=="number"?S[0]:0;return z>0?z:m},tn=(i,m,S,z,G,R,pe)=>{const y=i==="selfBuffs"?1:Math.max(i==="groupBuffs"?R-1:pe-1,0);return!y||!G?{generationMs:0,wastedMs:0}:m?{generationMs:S*G*y,wastedMs:z*G*y}:{generationMs:S/100*G*y,wastedMs:z/100*G*y}},jn=i=>{const m=new Map,S=new Map;return i.forEach(R=>{const pe=R.details;if(!pe)return;const y=pe.durationMS||0,ae=pe.buffMap||{};Object.entries(ae).forEach(([Q,se])=>{if(!m.has(Q)){m.set(Q,se);return}const de=m.get(Q)||{},oe={name:de.name||se.name,stacking:de.stacking??se.stacking,icon:de.icon||se.icon,classification:de.classification||se.classification};m.set(Q,oe)});const Ve=(pe.players||[]).filter(Q=>!Q.notInSquad),We=Ve.length,$e=new Map;Ve.forEach(Q=>{const se=Q.group??0;$e.set(se,($e.get(se)||0)+1)}),Ve.forEach(Q=>{const se=Q.account||Q.name||Q.character_name||"Unknown",de=Q.profession||"Unknown",oe=Q.group??0,we=$e.get(oe)||1,Ie=Hn(Q,y);S.has(se)||S.set(se,{account:se,profession:de,professions:new Set,professionTimeMs:{},activeTimeMs:0,numFights:0,groupSupported:0,squadSupported:0,boons:{}});const re=S.get(se);re.profession=de,de!=="Unknown"&&(re.professions.add(de),re.professionTimeMs[de]=(re.professionTimeMs[de]||0)+Ie),re.activeTimeMs+=Ie,re.numFights+=1,re.groupSupported+=we,re.squadSupported+=We,Zt.forEach(Ne=>{(Q[Ne]||[]).forEach(D=>{var Ce,He,ze,Ge;if(typeof(D==null?void 0:D.id)!="number")return;const ce=en(D.id),fe=ae[ce];if(!yt(fe))return;const Se=(fe==null?void 0:fe.stacking)??!1,De=((He=(Ce=D.buffData)==null?void 0:Ce[0])==null?void 0:He.generation)??0,me=((Ge=(ze=D.buffData)==null?void 0:ze[0])==null?void 0:Ge.wasted)??0,{generationMs:Ue,wastedMs:ge}=tn(Ne,Se,De,me,y,we,We);!Ue&&!ge||(m.has(ce)||m.set(ce,fe||{}),re.boons[ce]||(re.boons[ce]={selfBuffs:{generationMs:0,wastedMs:0},groupBuffs:{generationMs:0,wastedMs:0},squadBuffs:{generationMs:0,wastedMs:0}}),re.boons[ce][Ne].generationMs+=Ue,re.boons[ce][Ne].wastedMs+=ge)})})})}),{boonTables:Array.from(m.keys()).filter(R=>yt(m.get(R))).map(R=>{const pe=m.get(R)||{},y=[];return S.forEach(ae=>{var Q;const he=ae.boons[R];if(!he||!Zt.some(se=>he[se].generationMs>0||he[se].wastedMs>0))return;const We=Array.from(ae.professions||[]).filter(se=>se&&se!=="Unknown");let $e=ae.profession;if(We.length>0){$e=We[0];let se=((Q=ae.professionTimeMs)==null?void 0:Q[$e])||0;We.forEach(de=>{var we;const oe=((we=ae.professionTimeMs)==null?void 0:we[de])||0;oe>se&&(se=oe,$e=de)})}y.push({account:ae.account,profession:$e||"Unknown",professionList:We,activeTimeMs:ae.activeTimeMs||1,numFights:ae.numFights||1,groupSupported:ae.groupSupported||1,squadSupported:ae.squadSupported||1,categories:{selfBuffs:{...he.selfBuffs},groupBuffs:{...he.groupBuffs},squadBuffs:{...he.squadBuffs}}})}),{id:R,name:pe.name||R,icon:pe.icon,stacking:pe.stacking??!1,rows:y}}).filter(R=>R.rows.length>0)}},Rt=(i,m,S,z,G,R,pe={})=>{var Q,se,de,oe;const ae=((i==null?void 0:i[m])||[]).find(we=>we.id===S);if(!ae)return{generationMs:0,wastedMs:0};const he=pe[en(S)],Ve=(he==null?void 0:he.stacking)??!1,We=((se=(Q=ae.buffData)==null?void 0:Q[0])==null?void 0:se.generation)??0,$e=((oe=(de=ae.buffData)==null?void 0:de[0])==null?void 0:oe.wasted)??0;return tn(m,Ve,We,$e,z,G,R)};var Wn={methods:{tiered:{tiers:{shortMs:500,mediumMs:1500,weights:{short:.5,medium:1,long:2}}}}};const zn=Wn,Ot="count",Vn=i=>(i||0)/1e3,Kn=(i,m)=>{var G;if(!i)return 0;const S=(G=zn.methods.tiered)==null?void 0:G.tiers;if(!S)return i;const z=m/Math.max(i,1);return z<=S.shortMs?i*S.weights.short:z<=S.mediumMs?i*S.weights.medium:i*S.weights.long},nn=(i,m,S)=>S==="duration"?Vn(m):S==="tiered"?Kn(i,m):i;function Gn(i,m=Ot){var R;const S=(R=i.statsAll)==null?void 0:R[0],z=Number((S==null?void 0:S.appliedCrowdControl)??0),G=Number((S==null?void 0:S.appliedCrowdControlDuration)??0);return nn(z,G,m)}function Jn(i,m){const S=(m==null?void 0:m.durationMS)||0,z=(m==null?void 0:m.buffMap)||{},G=i.filter(y=>!y.notInSquad),R=G.length,pe=new Map;G.forEach(y=>{const ae=y.group??0;pe.set(ae,(pe.get(ae)||0)+1)}),G.forEach(y=>{const ae=pe.get(y.group??0)||1,he=Rt(y,"selfBuffs",1122,S,ae,R,z),Ve=Rt(y,"squadBuffs",1122,S,ae,R,z);y.stabGeneration=(he.generationMs+Ve.generationMs)/1e3})}function Yn(i){if(!i.statsTargets)return 0;let m=0;for(const S of i.statsTargets)S&&S.length>0&&(m+=S[0].downContribution||0);return m}function Qn(i){if(!i.extBarrierStats||!i.extBarrierStats.outgoingBarrierAllies)return 0;let m=0;for(const S of i.extBarrierStats.outgoingBarrierAllies)if(S)for(const z of S)z&&(m+=z.barrier||0);return m}function Xn(i){if(!i.extHealingStats||!i.extHealingStats.outgoingHealingAllies)return 0;let m=0;for(const S of i.extHealingStats.outgoingHealingAllies)if(S)for(const z of S)z&&(m+=z.healing||0);return m}const sn=i=>{var m,S,z,G;return(((S=(m=i.support)==null?void 0:m[0])==null?void 0:S.condiCleanse)||0)+(((G=(z=i.support)==null?void 0:z[0])==null?void 0:G.condiCleanseSelf)||0)},on=(i,m=Ot)=>{var R;const S=(R=i.support)==null?void 0:R[0],z=Number((S==null?void 0:S.boonStrips)??0),G=Number((S==null?void 0:S.boonStripsTime)??0);return nn(z,G,m)},an=i=>Yn(i),rn=i=>Xn(i),cn=i=>Qn(i),un=(i,m=Ot)=>Gn(i,m),Zn=(i,m)=>Jn(i,m),yn="count",es={downContribution:1,healing:1,cleanses:1,strips:1,stability:1,cc:.7,revives:.7,distanceToTag:.7,participation:.7,dodging:.4,dps:.2,damage:.2},ts={showMvp:!0,topSkillDamageSource:"target",topSkillsMetric:"damage"},mn=new Map([["bleeding","Bleeding"],["burning","Burning"],["confusion","Confusion"],["poison","Poison"],["torment","Torment"],["vulnerability","Vulnerability"],["weakness","Weakness"],["weakened","Weakness"],["blind","Blind"],["blinded","Blind"],["blinding","Blind"],["cripple","Cripple"],["crippled","Cripple"],["chill","Chill"],["chilled","Chill"],["immob","Immobilize"],["immobile","Immobilize"],["immobilized","Immobilize"],["slow","Slow"],["slowed","Slow"],["fear","Fear"],["feared","Fear"],["taunt","Taunt"],["taunted","Taunt"]]),ns={Blind:"https://render.guildwars2.com/file/09770136BB76FD0DBE1CC4267DEED54774CB20F6/102837.png",Chill:"https://render.guildwars2.com/file/28C4EC547A3516AF0242E826772DA43A5EAC3DF3/102839.png",Cripple:"https://render.guildwars2.com/file/070325E519C178D502A8160523766070D30C0C19/102838.png",Fear:"https://render.guildwars2.com/file/30307A6E766D74B6EB09EDA12A4A2DE50E4D76F4/102869.png",Immobilize:"https://render.guildwars2.com/file/397A613651BFCA2832B6469CE34735580A2C120E/102844.png",Slow:"https://render.guildwars2.com/file/F60D1EF5271D7B9319610855676D320CD25F01C6/961397.png",Taunt:"https://render.guildwars2.com/file/02EED459AD65FAF7DF32A260E479C625070841B9/1228472.png",Vulnerability:"https://render.guildwars2.com/file/3A394C1A0A3257EB27A44842DDEEF0DF000E1241/102850.png",Weakness:"https://render.guildwars2.com/file/6CB0E64AF9AA292E332A38C1770CE577E2CDE0E8/102853.png"},pt=i=>{if(!i)return null;const m=i.trim().toLowerCase(),S=mn.get(m);if(S)return S;const z=m.split(/[^a-z]+/).filter(Boolean);for(const G of z){const R=mn.get(G);if(R)return R}return null},ss=i=>pt(i),ln=i=>{const m=new Map;return i&&(Object.values(i).forEach(S=>{if(!(S!=null&&S.icon)||!(S!=null&&S.name))return;const z=pt(S.name);z&&(m.has(z)||m.set(z,S.icon))}),Object.entries(ns).forEach(([S,z])=>{m.has(S)||m.set(S,z)})),m},wt=(i,m,S)=>{var z;if(m&&S){const G=(z=S[`b${m}`])==null?void 0:z.name,R=pt(G);if(R)return R}return i?pt(i):null},is=i=>{const m=(i==null?void 0:i.account)||"Unknown";return m&&m!=="Unknown"?m:(i==null?void 0:i.name)||"Unknown"||null},os=i=>{if(!i||i.length===0)return 0;let m=0,S=null;return i.forEach(z=>{const G=Number(z[1]??0);if(Number.isFinite(G)){if(S===null){S=G;return}G>S&&(m+=G-S),S=G}}),m},as=i=>{if(!i||i.length===0)return 0;let m=0;return i.forEach(S=>{const z=Number(S[0]??0),G=Number(S[1]??0);Number.isFinite(G)&&z!==0&&G>0&&(m+=1)}),m},rs=i=>{const{players:m,targets:S,skillMap:z,buffMap:G}=i,R=i.getPlayerKey||is,pe=ln(G),y={},ae={};m.forEach(Q=>{if(Q!=null&&Q.notInSquad)return;const se=R(Q);se&&(y[se]||(y[se]={}),Q!=null&&Q.totalDamageDist&&Q.totalDamageDist.forEach(de=>{de&&de.forEach(oe=>{if(!oe.id)return;let we=`Skill ${oe.id}`,Ie;z&&(z[`s${oe.id}`]?(we=z[`s${oe.id}`].name||we,Ie=z[`s${oe.id}`].icon||Ie):z[`${oe.id}`]&&(we=z[`${oe.id}`].name||we,Ie=z[`${oe.id}`].icon||Ie));const re=wt(we,oe.id,G);if(!re)return;const Ne=G==null?void 0:G[`b${oe.id}`],Qe=Ne==null?void 0:Ne.name,D=pe.get(re)||(Ne==null?void 0:Ne.icon),ce=we.startsWith("Skill ")?Qe||re:we,fe=Ie||(Ne==null?void 0:Ne.icon),Se=Number(oe.connectedHits??0),De=Number(oe.hits??0),me=Se>0?Se:De,Ue=Number(oe.totalDamage??0);if(!Number.isFinite(me)&&!Number.isFinite(Ue))return;const ge=ae[re]||{name:re,icon:D,applications:0,damage:0};ge.applications+=Number.isFinite(me)?me:0,ge.damage+=Number.isFinite(Ue)?Ue:0,!ge.icon&&D&&(ge.icon=D),ae[re]=ge;const Ce=y[se][re]||{icon:D,applications:0,damage:0,skills:{}};Ce.applications+=Number.isFinite(me)?me:0,Ce.damage+=Number.isFinite(Ue)?Ue:0;const He=Ce.skills[ce]||{name:ce,hits:0,damage:0,icon:fe};He.hits+=Number.isFinite(me)?me:0,He.damage+=Number.isFinite(Ue)?Ue:0,!He.icon&&fe&&(He.icon=fe),Ce.skills[ce]=He,!Ce.icon&&D&&(Ce.icon=D),y[se][re]=Ce})}))});const he=new Map;m.forEach(Q=>{if(Q!=null&&Q.notInSquad)return;const se=R(Q);se&&Q!=null&&Q.name&&he.set(Q.name,se)});let Ve=0,We=0,$e=0;return S.forEach(Q=>{Q!=null&&Q.buffs&&Q.buffs.forEach(se=>{const de=Number(se==null?void 0:se.id);if(!Number.isFinite(de))return;const oe=G==null?void 0:G[`b${de}`],we=pt(oe==null?void 0:oe.name);if(!we||oe!=null&&oe.classification&&oe.classification!=="Condition")return;const Ie=we;if(!Ie)return;const re=se.statesPerSource||{};$e+=1,Object.entries(re).forEach(([Ne,Qe])=>{var me;const D=he.get(Ne);if(!D)return;We+=1;const ce=os(Qe),fe=as(Qe);Ve+=ce;const Se=((me=y[D])==null?void 0:me[Ie])||{applications:0,damage:0,skills:{}};Se.applicationsFromBuffs=(Se.applicationsFromBuffs||0)+ce,Se.applicationsFromBuffsActive=(Se.applicationsFromBuffsActive||0)+fe,y[D]=y[D]||{},y[D][Ie]=Se;const De=ae[Ie]||{name:Ie,applications:0,damage:0};De.applicationsFromBuffs=(De.applicationsFromBuffs||0)+ce,De.applicationsFromBuffsActive=(De.applicationsFromBuffsActive||0)+fe,ae[Ie]=De})})}),Object.values(y).forEach(Q=>{Object.values(Q).forEach(se=>{typeof se.applicationsFromBuffs=="number"&&(se.applications=se.applicationsFromBuffs)})}),Object.values(ae).forEach(Q=>{typeof Q.applicationsFromBuffs=="number"&&(Q.applications=Q.applicationsFromBuffs)}),{playerConditions:y,summary:ae,meta:{buffStateApplicationsTotal:Ve,targetBuffEntriesSeen:$e,buffStateSourcesSeen:We}}},cs=new Set(["Vulnerability","Weakness","Blind","Cripple","Chill","Immobilize","Slow","Fear","Taunt"]),us=[{id:"damage",label:"Damage",field:"damage",source:"dpsAll"},{id:"directDmg",label:"Direct Damage",field:"directDmg",source:"statsTargets"},{id:"connectedDamageCount",label:"Connected Damage Count",field:"connectedDamageCount",source:"statsTargets"},{id:"connectedDirectDamageCount",label:"Connected Direct Damage Count",field:"connectedDirectDamageCount",source:"statsTargets"},{id:"battleStandardHits",label:"Battle Standard Tracking"},{id:"criticalRate",label:"Critical Rate",field:"criticalRate",isRate:!0,isPercent:!0,denomField:"critableDirectDamageCount",source:"statsTargets"},{id:"criticalDmg",label:"Critical Damage",field:"criticalDmg",source:"statsTargets"},{id:"flankingRate",label:"Flanking Rate",field:"flankingRate",isRate:!0,isPercent:!0,denomField:"connectedDirectDamageCount",source:"statsTargets"},{id:"glanceRate",label:"Glance Rate",field:"glanceRate",isRate:!0,isPercent:!0,denomField:"connectedDirectDamageCount",source:"statsTargets"},{id:"missed",label:"Missed",field:"missed",source:"statsTargets"},{id:"evaded",label:"Evaded (enemy)",field:"evaded",source:"statsTargets"},{id:"blocked",label:"Blocked (enemy)",field:"blocked",source:"statsTargets"},{id:"interrupts",label:"Interrupts",field:"interrupts",source:"statsTargets"},{id:"invulned",label:"Invulned",field:"invulned",source:"statsTargets"},{id:"killed",label:"Killed",field:"killed",source:"statsTargets"},{id:"downed",label:"Downed",field:"downed",source:"statsTargets"},{id:"downContribution",label:"Down Contribution",field:"downContribution",source:"statsTargets"},{id:"downContributionPercent",label:"Down Contribution %",isRate:!0,isPercent:!0},{id:"againstDownedDamage",label:"Against Downed Damage",field:"againstDownedDamage",source:"statsTargets"},{id:"appliedCrowdControl",label:"Applied CC",field:"appliedCrowdControl",source:"statsTargets"},{id:"appliedCrowdControlDuration",label:"Applied CC Duration",field:"appliedCrowdControlDuration",source:"statsTargets"},{id:"appliedCrowdControlDownContribution",label:"Applied CC Down Contribution",field:"appliedCrowdControlDownContribution",source:"statsTargets"},{id:"appliedCrowdControlDurationDownContribution",label:"Applied CC Duration Down Contribution",field:"appliedCrowdControlDurationDownContribution",source:"statsTargets"},{id:"boonStrips",label:"Boon Strips",field:"boonStrips",source:"support"}],ms=[{id:"damageTaken",label:"Damage Taken",field:"damageTaken"},{id:"minionDamageTaken",label:"Minion Damage Taken"},{id:"damageTakenCount",label:"Damage Taken Count",field:"damageTakenCount"},{id:"conditionDamageTaken",label:"Condition Damage Taken",field:"conditionDamageTaken"},{id:"conditionDamageTakenCount",label:"Condition Damage Taken Count",field:"conditionDamageTakenCount"},{id:"powerDamageTaken",label:"Power Damage Taken",field:"powerDamageTaken"},{id:"powerDamageTakenCount",label:"Power Damage Taken Count",field:"powerDamageTakenCount"},{id:"downedDamageTaken",label:"Downed Damage Taken",field:"downedDamageTaken"},{id:"downedDamageTakenCount",label:"Downed Damage Taken Count",field:"downedDamageTakenCount"},{id:"damageBarrier",label:"Damage Barrier",field:"damageBarrier"},{id:"damageBarrierCount",label:"Damage Barrier Count",field:"damageBarrierCount"},{id:"blockedCount",label:"Blocked Count",field:"blockedCount"},{id:"evadedCount",label:"Evaded Count",field:"evadedCount"},{id:"missedCount",label:"Missed Count",field:"missedCount"},{id:"dodgeCount",label:"Dodge Count",field:"dodgeCount"},{id:"invulnedCount",label:"Invulnerable Count",field:"invulnedCount"},{id:"interruptedCount",label:"Interrupted Count",field:"interruptedCount"},{id:"downCount",label:"Down Count",field:"downCount"},{id:"deadCount",label:"Death Count",field:"deadCount"},{id:"boonStrips",label:"Boon Strips (Incoming)",field:"boonStrips"},{id:"conditionCleanses",label:"Cleanses (Incoming)",field:"conditionCleanses"},{id:"receivedCrowdControl",label:"Crowd Control (Incoming)",field:"receivedCrowdControl"}],ls=[{id:"condiCleanse",label:"Condition Cleanses",field:"condiCleanse"},{id:"condiCleanseTime",label:"Condition Cleanse Time",field:"condiCleanseTime",isTime:!0},{id:"condiCleanseSelf",label:"Condition Cleanse Self",field:"condiCleanseSelf"},{id:"condiCleanseTimeSelf",label:"Condition Cleanse Time Self",field:"condiCleanseTimeSelf",isTime:!0},{id:"boonStrips",label:"Boon Strips",field:"boonStrips"},{id:"boonStripsTime",label:"Boon Strips Time",field:"boonStripsTime",isTime:!0},{id:"boonStripDownContribution",label:"Boon Strip Down Contribution",field:"boonStripDownContribution"},{id:"boonStripDownContributionTime",label:"Boon Strip Down Contribution Time",field:"boonStripDownContributionTime",isTime:!0},{id:"stunBreak",label:"Stun Breaks",field:"stunBreak"},{id:"removedStunDuration",label:"Removed Stun Duration",field:"removedStunDuration",isTime:!0},{id:"resurrects",label:"Resurrects",field:"resurrects"},{id:"resurrectTime",label:"Resurrect Time",field:"resurrectTime",isTime:!0}],fs=["battle standard","glyph of renewal","glyph of the stars","illusion of life","spirit of nature","nature spirit","search and rescue","signet of mercy"],ds=new Set([10244]),gs=(i,m)=>{var G;if(ds.has(i))return!0;const S=(m==null?void 0:m[`s${i}`])||(m==null?void 0:m[`${i}`]),z=((G=S==null?void 0:S.name)==null?void 0:G.toLowerCase())||"";return fs.some(R=>z.includes(R))},Tt=i=>{if(!i||!Number.isFinite(i))return"--:--";const m=Math.max(0,Math.round(i/1e3)),S=Math.floor(m/3600),z=Math.floor(m%3600/60),G=m%60;return S>0?`${S}:${String(z).padStart(2,"0")}:${String(G).padStart(2,"0")}`:`${z}:${String(G).padStart(2,"0")}`},Ft={Guardian:"#72C1D9",Dragonhunter:"#72C1D9",Firebrand:"#72C1D9",Willbender:"#72C1D9",Revenant:"#D16E5A",Herald:"#D16E5A",Renegade:"#D16E5A",Vindicator:"#D16E5A",Warrior:"#FFD166",Berserker:"#FFD166",Spellbreaker:"#FFD166",Bladesworn:"#FFD166",Engineer:"#D09C59",Scrapper:"#D09C59",Holosmith:"#D09C59",Mechanist:"#D09C59",Ranger:"#8CDC82",Druid:"#8CDC82",Soulbeast:"#8CDC82",Untamed:"#8CDC82",Thief:"#C08F95",Daredevil:"#C08F95",Deadeye:"#C08F95",Specter:"#C08F95",Elementalist:"#F68A87",Tempest:"#F68A87",Weaver:"#F68A87",Catalyst:"#F68A87",Mesmer:"#B679D5",Chronomancer:"#B679D5",Mirage:"#B679D5",Virtuoso:"#B679D5",Necromancer:"#52A76F",Reaper:"#52A76F",Scourge:"#52A76F",Harbinger:"#52A76F",Ritualist:"#52A76F",Luminary:"#72C1D9",Conduit:"#D16E5A",Paragon:"#FFD166",Amalgam:"#D09C59",Galeshot:"#8CDC82",Antiquary:"#C08F95",Evoker:"#F68A87",Troubadour:"#B679D5",Unknown:"#64748B"};function fn(i){return Ft[i]||Ft.Unknown}const bs=i=>{if(i==null||i==="")return 0;if(typeof i=="number")return!Number.isFinite(i)||i<=0?0:i>1e12?i:i*1e3;if(i instanceof Date){const pe=i.getTime();return Number.isFinite(pe)&&pe>0?pe:0}const m=String(i).trim();if(!m)return 0;const S=Number(m);if(Number.isFinite(S)&&S>0)return S>1e12?S:S*1e3;const z=Date.parse(m);if(Number.isFinite(z)&&z>0)return z;const G=m.replace(/([+-]\d{2})$/,"$1:00"),R=Date.parse(G);return Number.isFinite(R)&&R>0?R:0},Oe=(i,m)=>bs((i==null?void 0:i.timeStartStd)??(i==null?void 0:i.timeStart)??(i==null?void 0:i.timeEndStd)??(i==null?void 0:i.timeEnd)??(i==null?void 0:i.timeStartText)??(i==null?void 0:i.timeEndText)??(i==null?void 0:i.uploadTime)??(m==null?void 0:m.uploadTime)),ps=({logs:i,precomputedStats:m,mvpWeights:S,statsViewSettings:z,disruptionMethod:G,includePlayerSkillMap:R})=>{const pe=Q=>{var de;return(Array.isArray((de=Q==null?void 0:Q.details)==null?void 0:de.players)?Q.details.players:[]).length>0},y=i.filter(Q=>pe(Q)),ae=z||ts,he=S||es,Ve=Q=>{if(!Q||typeof Q!="object")return Q;const se=Array.isArray(Q.fightBreakdown)?Q.fightBreakdown:null;if(!se||se.length===0)return Q;const de=D=>Array.isArray(D)&&D.some(ce=>ce&&Number(ce.count)>0),oe=new Map,we=new Map;i.forEach(D=>{var Se;const ce=(D==null?void 0:D.filePath)||(D==null?void 0:D.id);ce&&oe.set(String(ce),D);const fe=(D==null?void 0:D.permalink)||((Se=D==null?void 0:D.details)==null?void 0:Se.permalink);typeof fe=="string"&&fe.trim()&&we.set(fe.trim(),D)});const Ie=se.map(D=>{var Ue;if(!D||typeof D!="object")return D;const ce=D.id?String(D.id):"",fe=typeof D.permalink=="string"?D.permalink.trim():"",Se=(ce?oe.get(ce):void 0)||(fe?we.get(fe):void 0);if(!Se)return D;let De=D;if(Number(D.timestamp)<=0){const ge=Oe(Se==null?void 0:Se.details,Se);ge&&(De={...De,timestamp:ge})}const me=(Ue=Se==null?void 0:Se.details)==null?void 0:Ue.teamBreakdown;return de(me)&&(De={...De,teamBreakdown:me}),De}),re=Array.isArray(Q.fightDiffMode)?Q.fightDiffMode:[],Qe=re.some(D=>Array.isArray(D==null?void 0:D.targetFocus)&&D.targetFocus.some(ce=>Number((ce==null?void 0:ce.damage)||0)>0||Number((ce==null?void 0:ce.hits)||0)>0))?re:Ie.map((D,ce)=>{const fe=D&&typeof D.enemyClassCounts=="object"&&D.enemyClassCounts?D.enemyClassCounts:{},Se=Object.entries(fe).map(([je,Ke])=>({label:String(je||"Unknown"),count:Number(Ke||0)})).filter(je=>je.count>0).sort((je,Ke)=>Ke.count-je.count||je.label.localeCompare(Ke.label)),De=Se.reduce((je,Ke)=>je+Ke.count,0),me=Se.map(je=>({label:je.label,damage:je.count,hits:0,share:De>0?je.count/De:0})),Ue=Number((D==null?void 0:D.enemyDowns)||0),ge=Number((D==null?void 0:D.enemyDeaths)||0),Ce=Number((D==null?void 0:D.alliesDown)||0),He=Number((D==null?void 0:D.alliesDead)||0),ze=Number((D==null?void 0:D.totalOutgoingDamage)||0),Ge=Number((D==null?void 0:D.totalIncomingDamage)||0),xe=[{metricId:"winFlag",metricLabel:"Win (1) / Loss (0)",higherIsBetter:!0,value:D!=null&&D.isWin?1:0},{metricId:"squadCount",metricLabel:"Squad Size",higherIsBetter:!0,value:Number((D==null?void 0:D.squadCount)||0)},{metricId:"enemyCount",metricLabel:"Enemy Count",higherIsBetter:!1,value:Number((D==null?void 0:D.enemyCount)||0)},{metricId:"squadKdr",metricLabel:"Squad KDR",higherIsBetter:!0,value:He>0?ge/He:ge},{metricId:"enemyDeaths",metricLabel:"Enemy Deaths",higherIsBetter:!0,value:ge},{metricId:"enemyDowns",metricLabel:"Enemy Downs",higherIsBetter:!0,value:Ue},{metricId:"squadDeaths",metricLabel:"Squad Deaths",higherIsBetter:!1,value:He},{metricId:"squadDowns",metricLabel:"Squad Downs",higherIsBetter:!1,value:Ce},{metricId:"damageDelta",metricLabel:"Damage Delta",higherIsBetter:!0,value:ze-Ge},{metricId:"outgoingDamage",metricLabel:"Outgoing Damage",higherIsBetter:!0,value:ze},{metricId:"incomingDamage",metricLabel:"Incoming Damage",higherIsBetter:!1,value:Ge},{metricId:"barrierIncomingAbsorb",metricLabel:"Barrier Absorption (Incoming)",higherIsBetter:!0,value:Number((D==null?void 0:D.incomingBarrierAbsorbed)||0)},{metricId:"enemyBarrierAbsorb",metricLabel:"Enemy Barrier Absorption",higherIsBetter:!1,value:Number((D==null?void 0:D.outgoingBarrierAbsorbed)||0)},{metricId:"alliesRevived",metricLabel:"Allies Revived (Players)",higherIsBetter:!0,value:Number((D==null?void 0:D.alliesRevived)||0)}];return{id:String((D==null?void 0:D.id)||`fight-${ce+1}`),shortLabel:`F${ce+1}`,fullLabel:`${String((D==null?void 0:D.mapName)||(D==null?void 0:D.label)||"Unknown Map")} • ${String((D==null?void 0:D.duration)||"--:--")}`,mapName:String((D==null?void 0:D.mapName)||""),timestamp:Number((D==null?void 0:D.timestamp)||0),duration:String((D==null?void 0:D.duration)||"--:--"),isWin:!!(D!=null&&D.isWin),targetFocus:me,squadMetrics:xe}});return{...Q,fightBreakdown:Ie,fightDiffMode:Qe}},We=(()=>{if(m)return Ve(m);const Q=G||yn,se=ae.topSkillDamageSource||"target",de=ae.topSkillsMetric||"damage",oe=y.length;let we=0,Ie=0,re=0,Ne=0,Qe=0,D=0,ce=0,fe=0;const Se=e=>{const o=((e==null?void 0:e.players)||[]).filter(Z=>!Z.notInSquad);let M=0,r=0,_=0,C=0;return o.forEach(Z=>{var a;const K=(a=Z.defenses)==null?void 0:a[0];if(!K)return;const te=Number(K.downCount||0),F=Number(K.deadCount||0);M+=te+F,_+=F}),o.forEach(Z=>{!Z.statsTargets||Z.statsTargets.length===0||Z.statsTargets.forEach(K=>{const te=K==null?void 0:K[0];if(!te)return;const F=Number(te.downed||0),a=Number(te.killed||0);r+=F+a,C+=a})}),{squadDownsDeaths:M,enemyDownsDeaths:r,squadDeaths:_,enemyDeaths:C}},De=e=>{const{squadDownsDeaths:t,enemyDownsDeaths:o}=Se(e);return t>0||o>0?o>t:typeof(e==null?void 0:e.success)=="boolean"?e.success:!1},me=new Map,Ue=new Set(["boonStripsTime","condiCleanseTime","condiCleanseTimeSelf"]),ge={},Ce={},He=new Map,ze={},Ge={},xe={},je=new Map,Ke=new Map,Et=new Set(Object.keys(Ft)),It=Object.keys(Ft).filter(e=>e&&e!=="Unknown").sort((e,t)=>t.length-e.length),xt=["Guardian","Revenant","Warrior","Engineer","Ranger","Thief","Elementalist","Mesmer","Necromancer"],tt=e=>{if(!e)return"Unknown";const t=String(e).replace(/\s*\([^)]*\)\s*$/,"").replace(/\s*\[[^\]]*\]\s*$/,"").replace(/\s\d+$/,"").trim();if(Et.has(t))return t;const o=t.toLowerCase();for(const r of It)if(o.includes(r.toLowerCase()))return r;return xt.find(r=>o.includes(r.toLowerCase()))||t||"Unknown"},Cs=e=>e!=null&&e.classification?e.classification==="Boon":!0,Lt=new Map,Pt=new Map,kt=()=>({totalHits:0,blocked:0,evaded:0,glanced:0,missed:0,invulned:0,interrupted:0,totalMitigation:0,minMitigation:0}),Ee=e=>{const t=Number(e);return Number.isFinite(t)?t:0},kn=e=>{const t=String(e).split("|"),o=t[0]||"Unknown",M=tt(t[1]||"Unknown"),r=t[2]||o||"Unknown";return{name:o,profession:M,account:r}},Nn=(e,t,o)=>{let M=e.get(t);return M?o.profession&&!M.professionList.includes(o.profession)&&M.professionList.push(o.profession):(M={account:o.account,name:o.name,profession:o.profession,professionList:o.profession?[o.profession]:[],activeMs:0,mitigationTotals:kt()},e.set(t,M)),M},Sn=(e,t,o)=>{let M=e.get(t);return M?o.profession&&!M.professionList.includes(o.profession)&&M.professionList.push(o.profession):(M={account:o.account,name:o.name,profession:o.profession,professionList:o.profession?[o.profession]:[],activeMs:0,mitigationTotals:kt(),minion:o.minion},e.set(t,M)),M},Dn=(e,t)=>{e.totalHits+=Ee((t==null?void 0:t.skill_hits)??(t==null?void 0:t.skillHits)),e.blocked+=Ee(t==null?void 0:t.blocked),e.evaded+=Ee(t==null?void 0:t.evaded),e.glanced+=Ee(t==null?void 0:t.glanced),e.missed+=Ee(t==null?void 0:t.missed),e.invulned+=Ee(t==null?void 0:t.invulned),e.interrupted+=Ee(t==null?void 0:t.interrupted),e.totalMitigation+=Ee((t==null?void 0:t.avoided_damage)??(t==null?void 0:t.avoidedDamage)),e.minMitigation+=Ee((t==null?void 0:t.min_avoided_damage)??(t==null?void 0:t.minAvoidedDamage))},As=e=>Object.values(e).some(t=>t>0),Wt=new Map,Ms=e=>{const t=Wt.get(e);if(!t)return{hasSkill:!1,avg:1,min:1,hits:0};const o=t.connectedHits||0,M=o>0?t.totalDamage/o:0,r=t.minCount>0?t.minTotal/t.minCount:0;return{hasSkill:!0,avg:M,min:r,hits:o}},Cn=new Map,An=new Map,Mn=(e,t,o)=>{const M=e.get(t)||kt();return M.totalHits+=o.totalHits,M.blocked+=o.blocked,M.evaded+=o.evaded,M.glanced+=o.glanced,M.missed+=o.missed,M.invulned+=o.invulned,M.interrupted+=o.interrupted,e.set(t,M),M};y.forEach(e=>{const t=e.details;if(!t)return;(t.targets||[]).forEach(M=>{const r=(M==null?void 0:M.totalDamageDist)||[],_=Array.isArray(r)?r[0]:null;_==null||_.forEach(C=>{if(!(C!=null&&C.id))return;const Z=Number(C.id),K=Wt.get(Z)||{totalDamage:0,connectedHits:0,minTotal:0,minCount:0};K.totalDamage+=Number(C.totalDamage||0),K.connectedHits+=Number(C.connectedHits||0);const te=Number.isFinite(Number(C.min))?Number(C.min):0;K.minTotal+=te,K.minCount+=1,Wt.set(Z,K)})})}),y.forEach(e=>{var P,q;const t=e.details;if(!t)return;const o=t.players,M=t.targets||[],r=t.combatReplayMetaData||{},_=(r==null?void 0:r.inchToPixel)>0?r.inchToPixel:1,C=(r==null?void 0:r.pollingRate)>0?r.pollingRate:1,Z=5e3,K=s=>Array.isArray(s)?s.map(u=>Array.isArray(u)?[Number(u[0]),Number(u[1])]:null).filter(u=>!!u&&Number.isFinite(u[0])):[];let te=[],F=t.durationMS||0,a=!1;const c=o.find(s=>(s==null?void 0:s.hasCommanderTag)&&!(s!=null&&s.notInSquad));(P=c==null?void 0:c.combatReplayData)!=null&&P.positions&&(te=c.combatReplayData.positions,K(c.combatReplayData.dead).forEach(([u])=>{u>0&&(a=!0,F=Math.min(F,u))}));const x=s=>{var h;const u=(h=s.statsAll)==null?void 0:h[0];if((u==null?void 0:u.distToCom)!==void 0&&(u==null?void 0:u.distToCom)!=="Infinity")return Math.round(Number(u.distToCom));if((u==null?void 0:u.stackDist)!==void 0)return Math.round(Number(u.stackDist))||0;if(s.hasCommanderTag)return 0;const O=s.combatReplayData;if(!(O!=null&&O.positions)||!te.length)return 0;const J=O.positions,f=K(O.dead),n=K(O.down),ee=Math.floor((O.start||0)/C);let b=0;if(f.length&&n.length)for(const[H]of f){if(H<0)continue;const j=Math.max(0,Math.floor(H/C))-ee;for(const[U,w]of n){if(H!==w)continue;const W=a&&U>F?Math.max(1,Math.floor(F/C)):j,V=Math.max(0,Math.min(W,J.length,te.length));if(V<=0)continue;let ne=0;for(let ie=0;ie<V;ie++){const[le,ke]=J[ie],[Ae,Le]=te[ie];ne+=Math.hypot(le-Ae,ke-Le)}b=Math.round(ne/V/_)}}return b},d=o.filter(s=>!s.notInSquad);re+=d.length,Ne+=M.filter(s=>!s.isFake).length,Zn(o,{durationMS:t.durationMS,buffMap:t.buffMap});const{squadDeaths:L,enemyDeaths:$}=Se(t);Qe+=L,D+=$,fe+=L,ce+=$,De(t)?we++:Ie++;const g=t.skillMap?Number((q=Object.keys(t.skillMap).find(s=>{var u,O;return((O=(u=t.skillMap)==null?void 0:u[s])==null?void 0:O.name)==="Battle Standard"}))==null?void 0:q.replace(/^s/,"")):null;o.forEach((s,u)=>{var Xe,_e,Je,lt,ut,Ut,ft,mt,dt,Qt,gt,Nt,_t;if(s.notInSquad)return;const O=s.account||"Unknown",J=O!=="Unknown"?O:s.name||"Unknown",f=s.name||"Unknown";me.has(J)||me.set(J,{name:f,account:J,characterNames:new Set,downContrib:0,cleanses:0,strips:0,stab:0,healing:0,barrier:0,cc:0,logsJoined:0,totalDist:0,distCount:0,dodges:0,downs:0,deaths:0,totalFightMs:0,offenseTotals:{},offenseRateWeights:{},defenseActiveMs:0,defenseTotals:{},defenseMinionDamageTaken:{},supportActiveMs:0,supportTotals:{},healingActiveMs:0,healingTotals:{},profession:s.profession||"Unknown",professions:new Set,professionTimeMs:{},squadActiveMs:0,firstSeenFightTs:0,lastSeenFightTs:0,lastSeenFightDurationMs:0,isCommander:!1,damage:0,dps:0,revives:0,outgoingConditions:{},incomingConditions:{}});const n=me.get(J);if(s.hasCommanderTag&&(n.isCommander=!0),f!=="Unknown"&&n.characterNames.add(String(f)),s.profession&&s.profession!=="Unknown"){n.profession=s.profession,n.professions.add(s.profession);const I=Array.isArray(s.activeTimes)&&typeof s.activeTimes[0]=="number"?s.activeTimes[0]:t.durationMS||0;n.professionTimeMs[s.profession]=(n.professionTimeMs[s.profession]||0)+I}n.logsJoined++,n.downContrib+=an(s),n.cleanses+=sn(s),n.strips+=on(s,Q),n.healing+=rn(s),n.barrier+=cn(s),n.cc+=un(s,Q),n.stab+=s.stabGeneration||0;const ee=x(s);ee<=Z&&(n.totalDist+=ee,n.distCount++),(Xe=s.defenses)!=null&&Xe[0]&&(n.dodges+=s.defenses[0].dodgeCount||0,n.downs+=s.defenses[0].downCount||0,n.deaths+=s.defenses[0].deadCount||0),t.durationMS&&(n.totalFightMs+=t.durationMS);const b=Array.isArray(s.activeTimes)&&typeof s.activeTimes[0]=="number"?s.activeTimes[0]:t.durationMS||0;n.squadActiveMs+=b;const h=Oe(t,e),H=Number((t==null?void 0:t.durationMS)||0);if(h>0&&((n.firstSeenFightTs<=0||h<n.firstSeenFightTs)&&(n.firstSeenFightTs=h),n.lastSeenFightTs<=0||h>n.lastSeenFightTs?(n.lastSeenFightTs=h,n.lastSeenFightDurationMs=H):h===n.lastSeenFightTs&&H>n.lastSeenFightDurationMs&&(n.lastSeenFightDurationMs=H)),n.defenseActiveMs+=b,n.supportActiveMs+=b,n.healingActiveMs+=b,Array.isArray(s.buffUptimes)&&s.buffUptimes.length>0&&s.buffUptimes.forEach(I=>{var qn,Un,_n,$n,Rn,On;if(typeof(I==null?void 0:I.id)!="number")return;const E=`b${I.id}`,N=((qn=t.buffMap)==null?void 0:qn[E])||((Un=t.buffMap)==null?void 0:Un[String(I.id)]);if(!N||Cs(N))return;const T=Number((($n=(_n=I.buffData)==null?void 0:_n[0])==null?void 0:$n.uptime)??0),Y=Number(((On=(Rn=I.buffData)==null?void 0:Rn[0])==null?void 0:On.presence)??0);if((!Number.isFinite(T)||T<=0)&&(!Number.isFinite(Y)||Y<=0))return;const ue=(N==null?void 0:N.stacking)??!1,Fe=(ue?Number.isFinite(T)?T:0:Number.isFinite(T)?T/100:0)*b,Be=ue?Y:T,Ye=Math.min(Math.max(Number.isFinite(Be)?Be:0,0),100)/100*b,et=Number.isFinite(Fe)&&Fe>0,St=Number.isFinite(Ye)&&Ye>0;if(!et&&!St)return;const st=ss(N==null?void 0:N.name);if(st&&cs.has(st)&&(!(N!=null&&N.classification)||N.classification==="Condition")){const $t=Fe/1e3,it=N==null?void 0:N.icon,Dt=ze[st]||{name:st,icon:it,applications:0,damage:0};Dt.applicationsFromUptime=(Dt.applicationsFromUptime||0)+$t,!Dt.icon&&it&&(Dt.icon=it),ze[st]=Dt;const Ct=n.outgoingConditions[st]||{applications:0,damage:0,skills:{},icon:it};Ct.applicationsFromUptime=(Ct.applicationsFromUptime||0)+$t,!Ct.icon&&it&&(Ct.icon=it),n.outgoingConditions[st]=Ct;const At=Ge[st]||{name:st,icon:it,applications:0,damage:0};At.applicationsFromUptime=(At.applicationsFromUptime||0)+$t,!At.icon&&it&&(At.icon=it),Ge[st]=At;const Mt=n.incomingConditions[st]||{applications:0,damage:0,skills:{},icon:it};Mt.applicationsFromUptime=(Mt.applicationsFromUptime||0)+$t,!Mt.icon&&it&&(Mt.icon=it),n.incomingConditions[st]=Mt}je.has(E)||je.set(E,{name:N==null?void 0:N.name,stacking:ue,icon:N==null?void 0:N.icon}),Ke.has(E)||Ke.set(E,new Map);const Pn=Ke.get(E),Xt=n.account||s.account||s.name||"Unknown";let rt=Pn.get(Xt);rt||(rt={account:Xt,profession:n.profession||s.profession||"Unknown",professions:new Set,professionTimeMs:{},totalMs:0,uptimeMs:0,durationMs:0},Pn.set(Xt,rt));const bt=s.profession||n.profession;bt&&bt!=="Unknown"&&(rt.professions.add(bt),rt.professionTimeMs[bt]=(rt.professionTimeMs[bt]||0)+b,rt.profession=bt),rt.totalMs+=et?Fe:0,rt.uptimeMs+=St?Ye:0,rt.durationMs+=b}),(_e=s.defenses)!=null&&_e[0]){const I=T=>{let Y=String(T||"Unknown").replace(/^Juvenile\s+/i,"")||"Unknown";return Y.toUpperCase().includes("UNKNOWN")&&(Y="Unknown"),Y},N=(()=>{const T=Array.isArray(s==null?void 0:s.minions)?s.minions:[];if(T.length===0)return{total:0,byMinion:{}};let Y=0;const ue={};return T.forEach(be=>{const Fe=Array.isArray(be==null?void 0:be.totalDamageTakenDist)?be.totalDamageTakenDist:[],Be=Array.isArray(Fe[0])?Fe[0]:[],nt=I(be==null?void 0:be.name);Be.forEach(Ye=>{const et=Number((Ye==null?void 0:Ye.totalDamage)??(Ye==null?void 0:Ye.damageTaken)??0);Number.isFinite(et)&&(Y+=et,ue[nt]=(ue[nt]||0)+et)})}),{total:Y,byMinion:ue}})();N.byMinion&&typeof N.byMinion=="object"&&Object.entries(N.byMinion).forEach(([T,Y])=>{const ue=Number(Y||0);!Number.isFinite(ue)||ue<=0||(n.defenseMinionDamageTaken[T]=(n.defenseMinionDamageTaken[T]||0)+ue)}),ms.forEach(T=>{const Y=T.id==="minionDamageTaken"?N.total:Number(s.defenses[0][T.field]??0);Number.isFinite(Y)&&(n.defenseTotals[T.id]=(n.defenseTotals[T.id]||0)+Y)})}(Je=s.support)!=null&&Je[0]&&ls.forEach(I=>{let E=Number(s.support[0][I.field]??0);Number.isFinite(E)&&(Ue.has(I.field)&&E>999999&&(E=0),n.supportTotals[I.id]=(n.supportTotals[I.id]||0)+E)});const j=(I,E)=>{Number.isFinite(E)&&(n.healingTotals[I]=(n.healingTotals[I]||0)+E)},U=(I,E)=>Array.isArray(I)?I.reduce((N,T)=>N+Number((T==null?void 0:T[E])??0),0):0,w=(I,E,N)=>{if(!Number.isFinite(N)||N<=0)return;const T=o[E],Y=E===u,ue=T==null?void 0:T.notInSquad,be=!ue,Fe=be&&(T==null?void 0:T.group)!=null&&T.group===s.group;j(I,N),be&&j(`squad${I[0].toUpperCase()}${I.slice(1)}`,N),Fe&&j(`group${I[0].toUpperCase()}${I.slice(1)}`,N),Y&&j(`self${I[0].toUpperCase()}${I.slice(1)}`,N),ue&&j(`offSquad${I[0].toUpperCase()}${I.slice(1)}`,N)};if(Array.isArray(s.rotation)){let I=0;s.rotation.forEach(E=>{var T;if(!(E!=null&&E.id)||!gs(E.id,t.skillMap))return;const N=((T=E.skills)==null?void 0:T.length)||0;N>0&&(I+=N,j(`resUtility_s${E.id}`,N))}),I>0&&j("resUtility",I)}const W=(lt=s.extHealingStats)==null?void 0:lt.outgoingHealingAllies;Array.isArray(W)&&W.forEach((I,E)=>{const N=U(I,"healing"),T=U(I,"downedHealing");w("healing",E,N),w("downedHealing",E,T)});const V=(ut=s.extBarrierStats)==null?void 0:ut.outgoingBarrierAllies;Array.isArray(V)&&V.forEach((I,E)=>{const N=U(I,"barrier");w("barrier",E,N)});const ne=(Ut=s.statsAll)==null?void 0:Ut[0],ie=(ft=s.dpsAll)==null?void 0:ft[0],le=(mt=s.support)==null?void 0:mt[0];if(us.forEach(I=>{if(I.id==="downContributionPercent"||!I.field)return;let E=0,N=0;I.source==="dpsAll"&&ie?E=Number(ie[I.field]??0):I.source==="statsAll"&&ne?(E=Number(ne[I.field]??0),N=Number(ne[I.denomField||I.weightField||"connectedDamageCount"]??0)):I.source==="support"&&le?E=Number(le[I.field]??0):s.statsTargets&&s.statsTargets.forEach(T=>{T!=null&&T[0]&&(E+=Number(T[0][I.field]??0),N+=Number(T[0][I.denomField||I.weightField||"connectedDamageCount"]??0))}),Number.isFinite(E)&&(n.offenseTotals[I.id]=(n.offenseTotals[I.id]||0)+E,I.isRate&&N>0&&(n.offenseRateWeights[I.id]=(n.offenseRateWeights[I.id]||0)+N))}),s.targetDamageDist&&Number.isFinite(g)){const I=s.targetDamageDist.flatMap(E=>E||[]).flatMap(E=>E||[]).reduce((E,N)=>N!=null&&N.id&&N.id===g?E+((N==null?void 0:N.connectedHits)||0):E,0);n.offenseTotals.battleStandardHits=(n.offenseTotals.battleStandardHits||0)+I}n.revives+=((Qt=(dt=s.support)==null?void 0:dt[0])==null?void 0:Qt.resurrects)||0,ie&&(n.damage+=ie.damage||0,n.dps+=ie.dps||0);const ke=I=>{var Y,ue,be,Fe;let E=`Skill ${I.id}`;const N=((Y=t.skillMap)==null?void 0:Y[`s${I.id}`])||((ue=t.skillMap)==null?void 0:ue[`${I.id}`]);let T=N==null?void 0:N.icon;if(N!=null&&N.name&&(E=N.name),E.startsWith("Skill ")){const Be=wt(E,I.id,t.buffMap);Be&&(E=Be,T=((Fe=(be=t.buffMap)==null?void 0:be[`b${I.id}`])==null?void 0:Fe.icon)||T)}return{name:E,icon:T}},Ae=I=>{if(!(I!=null&&I.id))return;const{name:E,icon:N}=ke(I);ge[I.id]||(ge[I.id]={name:E,icon:N,damage:0,hits:0,downContribution:0}),ge[I.id].name.startsWith("Skill ")&&!E.startsWith("Skill ")&&(ge[I.id].name=E),!ge[I.id].icon&&N&&(ge[I.id].icon=N),ge[I.id].damage+=I.totalDamage,ge[I.id].hits+=I.connectedHits,ge[I.id].downContribution+=Number(I.downContribution||0)},Le=s.account||s.name||"Unknown",Me=s.profession||"Unknown",Re=`${Le}|${Me}`;let qe=He.get(Re);qe||(qe={key:Re,account:Le,displayName:Le,profession:Me,professionList:[Me],totalFightMs:0,skills:new Map},He.set(Re,qe)),qe.professionList.includes(Me)||qe.professionList.push(Me),qe.totalFightMs+=t.durationMS||0;const ve=I=>{if(!(I!=null&&I.id))return;const{name:E,icon:N}=ke(I),T=`s${I.id}`;let Y=qe.skills.get(T);Y||(Y={id:T,name:E,icon:N,damage:0,downContribution:0},qe.skills.set(T,Y)),Y.name.startsWith("Skill ")&&!E.startsWith("Skill ")&&(Y.name=E),!Y.icon&&N&&(Y.icon=N),Y.damage+=Number(I.totalDamage||0),Y.downContribution+=Number(I.downContribution||0)};if(se==="total")(gt=s.totalDamageDist)==null||gt.forEach(I=>{I==null||I.forEach(E=>{Ae(E),ve(E)})});else{const I=new Map;(Nt=s.targetDamageDist)==null||Nt.forEach(N=>{N==null||N.forEach(T=>{T==null||T.forEach(Y=>{const ue=Number(Y==null?void 0:Y.id);if(Number.isFinite(ue)){const be=I.get(ue)||{damage:0,hits:0,downContribution:0};be.damage+=Number((Y==null?void 0:Y.totalDamage)||0),be.hits+=Number((Y==null?void 0:Y.connectedHits)||0),be.downContribution+=Number((Y==null?void 0:Y.downContribution)||0),I.set(ue,be)}Ae(Y),ve(Y)})})}),!(t!=null&&t.detailedWvW)&&((_t=s.totalDamageDist)==null||_t.forEach(N=>{N==null||N.forEach(T=>{const Y=Number(T==null?void 0:T.id);if(!Number.isFinite(Y))return;const ue=I.get(Y);if(!ue){Ae(T),ve(T);return}const be=Number((T==null?void 0:T.totalDamage)||0),Fe=Number((T==null?void 0:T.connectedHits)||0),Be=Number((T==null?void 0:T.downContribution)||0),nt=be-Number(ue.damage||0),Ye=Fe-Number(ue.hits||0),et=Be-Number(ue.downContribution||0);if(nt<=0&&Ye<=0&&et<=0)return;const St={...T,totalDamage:Math.max(0,nt),connectedHits:Math.max(0,Ye),downContribution:Math.max(0,et)};Ae(St),ve(St)})}))}s.totalDamageTaken&&s.totalDamageTaken.forEach(I=>{I==null||I.forEach(E=>{var ue,be,Fe,Be;if(!(E!=null&&E.id))return;let N=`Skill ${E.id}`;const T=((ue=t.skillMap)==null?void 0:ue[`s${E.id}`])||((be=t.skillMap)==null?void 0:be[`${E.id}`]);let Y=T==null?void 0:T.icon;if(T!=null&&T.name&&(N=T.name),N.startsWith("Skill ")){const nt=wt(N,E.id,t.buffMap);nt&&(N=nt,Y=((Be=(Fe=t.buffMap)==null?void 0:Fe[`b${E.id}`])==null?void 0:Be.icon)||Y)}Ce[E.id]||(Ce[E.id]={name:N,icon:Y,damage:0,hits:0}),(!Ce[E.id].name.startsWith("Skill ")||N.startsWith("Skill "))&&(Ce[E.id].name=N),!Ce[E.id].icon&&Y&&(Ce[E.id].icon=Y),Ce[E.id].damage+=E.totalDamage,Ce[E.id].hits+=E.hits})})}),M.forEach(s=>{if(s!=null&&s.isFake)return;const u=tt((s==null?void 0:s.profession)||(s==null?void 0:s.name)||(s==null?void 0:s.id));u&&(xe[u]=(xe[u]||0)+1)});const p=rs({players:o,targets:M,skillMap:t.skillMap,buffMap:t.buffMap,getPlayerKey:s=>s.account&&s.account!=="Unknown"?s.account:s.name||null}),k=ln(t.buffMap);Object.entries(p.playerConditions).forEach(([s,u])=>{const O=me.get(s);O&&Object.entries(u).forEach(([J,f])=>{const n=O.outgoingConditions[J]||{applications:0,damage:0,skills:{},icon:f.icon};n.applications+=Number(f.applications||0),n.damage+=Number(f.damage||0),f.applicationsFromBuffs&&(n.applicationsFromBuffs=(n.applicationsFromBuffs||0)+f.applicationsFromBuffs),f.applicationsFromBuffsActive&&(n.applicationsFromBuffsActive=(n.applicationsFromBuffsActive||0)+f.applicationsFromBuffsActive),Object.entries(f.skills||{}).forEach(([ee,b])=>{const h=n.skills[ee]||{name:b.name,hits:0,damage:0,icon:b.icon};h.hits+=Number(b.hits||0),h.damage+=Number(b.damage||0),!h.icon&&b.icon&&(h.icon=b.icon),n.skills[ee]=h}),!n.icon&&f.icon&&(n.icon=f.icon),O.outgoingConditions[J]=n})}),Object.entries(p.summary).forEach(([s,u])=>{const O=ze[s]||{name:u.name||s,icon:u.icon,applications:0,damage:0};O.applications+=Number(u.applications||0),O.damage+=Number(u.damage||0),u.applicationsFromBuffs&&(O.applicationsFromBuffs=(O.applicationsFromBuffs||0)+u.applicationsFromBuffs),u.applicationsFromBuffsActive&&(O.applicationsFromBuffsActive=(O.applicationsFromBuffsActive||0)+u.applicationsFromBuffsActive),!O.icon&&u.icon&&(O.icon=u.icon),ze[s]=O}),d.forEach(s=>{const u=s.account&&s.account!=="Unknown"?s.account:s.name||"Unknown",O=me.get(u);!O||!s.totalDamageTaken||s.totalDamageTaken.forEach(J=>J==null?void 0:J.forEach(f=>{var ie,le,ke,Ae,Le,Me;if(!(f!=null&&f.id))return;let n=`Skill ${f.id}`;const ee=((ie=t.skillMap)==null?void 0:ie[`s${f.id}`])||((le=t.skillMap)==null?void 0:le[`${f.id}`]);ee!=null&&ee.name&&(n=ee.name);const b=wt(n,f.id,t.buffMap);if(!b)return;const h=(Ae=(ke=t.buffMap)==null?void 0:ke[`b${f.id}`])==null?void 0:Ae.name,H=k.get(b)||((Me=(Le=t.buffMap)==null?void 0:Le[`b${f.id}`])==null?void 0:Me.icon),j=(ee==null?void 0:ee.icon)||H;n.startsWith("Skill ")&&(h||b)&&(n=h||b);const U=Number(f.hits??0),w=Number(f.totalDamage??0),W=Ge[b]||{name:b,icon:H,applications:0,damage:0};W.applications+=Number.isFinite(U)?U:0,W.damage+=Number.isFinite(w)?w:0,!W.icon&&H&&(W.icon=H),Ge[b]=W;const V=O.incomingConditions[b]||{applications:0,damage:0,skills:{},icon:H};V.applications+=Number.isFinite(U)?U:0,V.damage+=Number.isFinite(w)?w:0;const ne=V.skills[n]||{name:n,hits:0,damage:0,icon:j};ne.hits+=Number.isFinite(U)?U:0,ne.damage+=Number.isFinite(w)?w:0,!ne.icon&&j&&(ne.icon=j),V.skills[n]=ne,!V.icon&&H&&(V.icon=H),O.incomingConditions[b]=V}))});const B=t.player_damage_mitigation||t.playerDamageMitigation,v=B&&typeof B=="object"&&Object.keys(B).length>0;v&&Object.entries(B).forEach(([s,u])=>{if(!u||typeof u!="object")return;const O=kn(s),J=Nn(Lt,O.account,O);Object.values(u).forEach(f=>{Ee((f==null?void 0:f.avoided_damage)??(f==null?void 0:f.avoidedDamage))<=0||Dn(J.mitigationTotals,f)})});const A=t.player_minion_damage_mitigation||t.playerMinionDamageMitigation,l=A&&typeof A=="object"&&Object.keys(A).length>0;l&&Object.entries(A).forEach(([s,u])=>{if(!u||typeof u!="object")return;const O=kn(s);Object.entries(u).forEach(([J,f])=>{if(!f||typeof f!="object")return;const n=`${O.account}::${J}`,ee=Sn(Pt,n,{...O,minion:String(J||"Unknown")});Object.values(f).forEach(b=>{Dn(ee.mitigationTotals,b)})})}),(!v||!l)&&(v||d.forEach(s=>{const u=(s==null?void 0:s.totalDamageTaken)||[];if(!Array.isArray(u)||u.length===0)return;const O=s.account||s.name||"Unknown",J={account:O,name:s.name||O,profession:tt(s.profession||"Unknown")};Nn(Lt,O,J);const f=Array.isArray(u)?u[0]:null;f==null||f.forEach(n=>{if(!(n!=null&&n.id))return;const ee=Ee(n.blocked),b=Ee(n.evaded),h=Ee(n.glance??n.glanced),H=Ee(n.missed),j=Ee(n.invulned),U=Ee(n.interrupted),w=Ee(n.hits??n.connectedHits),W=Number(n.id);Mn(Cn,`${O}::${W}`,{totalHits:w,blocked:ee,evaded:b,glanced:h,missed:H,invulned:j,interrupted:U})})}),l||d.forEach(s=>{const u=(s==null?void 0:s.minions)||[];if(!Array.isArray(u)||u.length===0)return;const O=s.account||s.name||"Unknown",J={account:O,name:s.name||O,profession:tt(s.profession||"Unknown")};u.forEach(f=>{const n=(f==null?void 0:f.totalDamageTakenDist)||[];if(!Array.isArray(n)||n.length===0)return;let ee=String((f==null?void 0:f.name)||"Unknown").replace(/^Juvenile\s+/i,"")||"Unknown";ee.toUpperCase().includes("UNKNOWN")&&(ee="Unknown");const b=`${O}::${ee}`;Sn(Pt,b,{...J,minion:ee});const h=Array.isArray(n)?n[0]:null;h==null||h.forEach(H=>{if(!(H!=null&&H.id))return;const j=Ee(H.blocked),U=Ee(H.evaded),w=Ee(H.glance??H.glanced),W=Ee(H.missed),V=Ee(H.invulned),ne=Ee(H.interrupted),ie=Ee(H.hits??H.connectedHits),le=Number(H.id);Mn(An,`${b}::${le}`,{totalHits:ie,blocked:j,evaded:U,glanced:w,missed:W,invulned:V,interrupted:ne})})})}))});const wn=(e,t)=>{const o=new Map,M=r=>{let _=o.get(r);return _||(_=kt(),o.set(r,_)),_};t.forEach((r,_)=>{const C=_.lastIndexOf("::"),Z=C>-1?_.slice(0,C):_,K=C>-1?Number(_.slice(C+2)):Number.NaN,te=Number.isFinite(K)?Ms(K):{hasSkill:!1,avg:0,min:0,hits:0};if(!te.hasSkill||te.hits<=0)return;const F=te.avg,a=te.min,c=r.glanced*F/2+(r.blocked+r.evaded+r.missed+r.invulned+r.interrupted)*F,x=r.glanced*a/2+(r.blocked+r.evaded+r.missed+r.invulned+r.interrupted)*a;if(c<=0)return;const d=M(Z);d.totalHits+=r.totalHits,d.blocked+=r.blocked,d.evaded+=r.evaded,d.glanced+=r.glanced,d.missed+=r.missed,d.invulned+=r.invulned,d.interrupted+=r.interrupted,d.totalMitigation+=c,d.minMitigation+=x}),e.forEach((r,_)=>{const C=o.get(_)||kt();r.mitigationTotals.totalHits=C.totalHits,r.mitigationTotals.blocked=C.blocked,r.mitigationTotals.evaded=C.evaded,r.mitigationTotals.glanced=C.glanced,r.mitigationTotals.missed=C.missed,r.mitigationTotals.invulned=C.invulned,r.mitigationTotals.interrupted=C.interrupted,r.mitigationTotals.totalMitigation=C.totalMitigation,r.mitigationTotals.minMitigation=C.minMitigation})};wn(Lt,Cn),wn(Pt,An);const ws=oe>0?Math.round(re/oe):0,Ts=oe>0?Math.round(Ne/oe):0,Fs=Qe>0?(D/Qe).toFixed(2):D>0?"∞":"0.00",Bs=ce>0?(fe/ce).toFixed(2):fe>0?"∞":"0.00",Tn=(e,t)=>{const M=e.filter(C=>Number.isFinite(C.value)&&(t?C.value>0:C.value>=0)).sort((C,Z)=>{const K=t?Z.value-C.value:C.value-Z.value;return K!==0?K:C.account.localeCompare(Z.account)});let r=null,_=0;return M.map((C,Z)=>((r===null||C.value!==r)&&(_=Z+1,r=C.value),{rank:_,...C}))},zt=Array.from(me.values()).map(e=>{const t=Array.from(e.professions).filter(o=>o!=="Unknown");if(e.professionList=t,t.length>0){let o=t[0],M=e.professionTimeMs[o]||0;t.forEach(r=>{const _=e.professionTimeMs[r]||0;_>M&&(M=_,o=r)}),e.profession=o}return{key:e.account,stat:e}}),Fn=e=>{const t=me.get(e.account);if(!t){const r=e.professionList.length>0?e.professionList:e.profession?[e.profession]:[];return{...e,professionList:r}}const o=t.professionList&&t.professionList.length>0?t.professionList:Array.from(t.professions||[]).filter(r=>r&&r!=="Unknown"),M=t.profession||e.profession;return{...e,profession:M,professionList:o.length>0?o:M?[M]:[],activeMs:t.defenseActiveMs||t.totalFightMs||e.activeMs}},vs=Array.from(Lt.values()).map(Fn).filter(e=>As(e.mitigationTotals)).sort((e,t)=>e.account.localeCompare(t.account)),Es=Array.from(Pt.values()).map(Fn).filter(e=>e.mitigationTotals.totalMitigation>0).sort((e,t)=>{const o=e.account.localeCompare(t.account);return o!==0?o:String(e.minion||"").localeCompare(String(t.minion||""))}),qt=(e,t)=>{switch(t){case"downContrib":return e.downContrib;case"barrier":return e.barrier;case"healing":return e.healing;case"dodges":return e.dodges;case"strips":return e.strips;case"cleanses":return e.cleanses;case"cc":return e.cc;case"stability":return e.stab;case"revives":return e.revives;case"dps":return e.dps;case"damage":return e.damage;case"participation":return e.logsJoined;case"closestToTag":return!e.isCommander&&e.distCount>0?e.totalDist/e.distCount:Number.POSITIVE_INFINITY;default:return 0}},ye=(e,t)=>Tn(zt.map(({stat:o})=>({account:o.account,profession:o.profession,professionList:o.professionList,value:qt(o,e),count:o.logsJoined})),t),Pe={downContrib:ye("downContrib",!0),barrier:ye("barrier",!0),healing:ye("healing",!0),dodges:ye("dodges",!0),strips:ye("strips",!0),cleanses:ye("cleanses",!0),cc:ye("cc",!0),stability:ye("stability",!0),revives:ye("revives",!0),participation:ye("participation",!0),dps:ye("dps",!0),damage:ye("damage",!0),closestToTag:ye("closestToTag",!1).filter(e=>Number.isFinite(e.value))},Is={downContrib:"downContrib",barrier:"barrier",healing:"healing",dodges:"dodges",strips:"strips",cleanses:"cleanses",cc:"cc",stability:"stability",closestToTag:"closestToTag"},Te=e=>{const t=e==null?void 0:e[0];return{value:(t==null?void 0:t.value)??0,player:(t==null?void 0:t.account)??"-",count:(t==null?void 0:t.count)??0,profession:(t==null?void 0:t.profession)??"Unknown",professionList:(t==null?void 0:t.professionList)??[]}},at={maxDownContrib:Te([]),maxBarrier:Te([]),maxHealing:Te([]),maxDodges:Te([]),maxStrips:Te([]),maxCleanses:Te([]),maxCC:Te([]),maxStab:Te([]),closestToTag:Te([])},ot={},xs=(e,t)=>{if(t==="closestToTag")return qt(e,t);const o=Math.max(1,(e.totalFightMs||0)/1e3);return qt(e,t)/o};Object.values(Is).forEach(e=>{const t=e!=="closestToTag";ot[e]=Tn(zt.map(({stat:o})=>({account:o.account,profession:o.profession,professionList:o.professionList,value:xs(o,e),count:o.logsJoined})),t)}),at.maxDownContrib=Te(ot.downContrib),at.maxBarrier=Te(ot.barrier),at.maxHealing=Te(ot.healing),at.maxDodges=Te(ot.dodges),at.maxStrips=Te(ot.strips),at.maxCleanses=Te(ot.cleanses),at.maxCC=Te(ot.cc),at.maxStab=Te(ot.stability),at.closestToTag=Te(ot.closestToTag);const Ls={maxDownContrib:Te(Pe.downContrib),maxBarrier:Te(Pe.barrier),maxHealing:Te(Pe.healing),maxDodges:Te(Pe.dodges),maxStrips:Te(Pe.strips),maxCleanses:Te(Pe.cleanses),maxCC:Te(Pe.cc),maxStab:Te(Pe.stability),closestToTag:Te(Pe.closestToTag)};let Vt={player:"None",account:"None",score:-1,profession:"Unknown",professionList:[],color:"#64748b",topStats:[]},Bn,vn,En=0;if(ae!=null&&ae.showMvp){const e={"Down Contribution":"downContribution",Healing:"healing",Cleanses:"cleanses",Strips:"strips",Stability:"stability",CC:"cc",Revives:"revives","Distance to Tag":"distanceToTag",Participation:"participation",Dodging:"dodging",DPS:"dps",Damage:"damage"},t=_=>{const C=e[_];return C?Number(he[C]||0)>0:!1},o=[],M=_=>[..._||[]].filter(C=>t(C==null?void 0:C.name)).sort((C,Z)=>Z.ratio-C.ratio||C.rank-Z.rank||C.name.localeCompare(Z.name)).slice(0,3),r=_=>{var Z;if(!_)return;const C=M(_.contribs);return{..._,player:_.name,reason:((Z=C[0])==null?void 0:Z.name)||"Top Performance",topStats:C}};zt.forEach(({stat:_})=>{let C=0;const Z=[],K=(te,F,a,c,x=!0)=>{var L,$;if(a<=0)return;const d=((L=F[0])==null?void 0:L.value)||0;if(d&&Number.isFinite(te)&&(x?te>0:te<Number.POSITIVE_INFINITY)){const X=x?te/d:d/te;C+=X*a;const g=(($=F.find(p=>p.account===_.account))==null?void 0:$.rank)||0;Z.push({name:c,ratio:X,val:te.toLocaleString(),rank:g})}};K(_.downContrib,Pe.downContrib,he.downContribution,"Down Contribution"),K(_.healing,Pe.healing,he.healing,"Healing"),K(_.cleanses,Pe.cleanses,he.cleanses,"Cleanses"),K(_.strips,Pe.strips,he.strips,"Strips"),K(_.stab,Pe.stability,he.stability,"Stability"),K(_.cc,Pe.cc,he.cc,"CC"),K(_.revives,Pe.revives,he.revives,"Revives"),K(qt(_,"closestToTag"),Pe.closestToTag,he.distanceToTag,"Distance to Tag",!1),K(_.logsJoined,Pe.participation,he.participation,"Participation"),K(_.dodges,Pe.dodges,he.dodging,"Dodging"),K(_.dps,Pe.dps,he.dps,"DPS"),K(_.damage,Pe.damage,he.damage,"Damage"),o.push({..._,score:C,contribs:Z.filter(te=>t(te.name))})}),o.sort((_,C)=>C.score-_.score),o[0]&&o[0].score>0&&(Vt=r(o[0])||Vt),Bn=r(o[1]),vn=r(o[2]),En=o.length>0?o.reduce((_,C)=>_+C.score,0)/o.length:0}const In=Object.values(ge).sort((e,t)=>t.damage-e.damage||t.hits-e.hits||String(e.name||"").localeCompare(String(t.name||""))).slice(0,25),xn=Object.values(ge).sort((e,t)=>t.downContribution-e.downContribution||t.hits-e.hits||String(e.name||"").localeCompare(String(t.name||""))).slice(0,25),Ps=de==="downContribution"?xn:In,qs=Object.values(Ce).sort((e,t)=>t.damage-e.damage).slice(0,25),Us=e=>{const t=String(e).replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),o=t.match(/^(Red|Blue|Green)\s+(?:Alpine|Desert)?\s*Borderlands$/i);return o?`${o[1]} Borderlands`:t||"Unknown"},ct=(e,t)=>Us((e==null?void 0:e.zone)||(e==null?void 0:e.mapName)||(e==null?void 0:e.map)||(e==null?void 0:e.location)||(e==null?void 0:e.fightName)||(t==null?void 0:t.fightName)||(t==null?void 0:t.encounterName)||"Unknown"),_s=(e,t)=>{const o=(t==null?void 0:t.permalink)||(e==null?void 0:e.permalink);if(typeof o=="string"&&o.trim().length>0)return o.trim();const M=e==null?void 0:e.uploadLinks;if(!Array.isArray(M))return"";for(const r of M){if(typeof r=="string"&&r.trim().length>0)return r.trim();if(r&&typeof r=="object"){const _=r.permalink||r.link||r.url||r.reportLink;if(typeof _=="string"&&_.trim().length>0)return _.trim()}}return""},$s=(e,t)=>{const o=Number((e==null?void 0:e.durationMS)||0);return o>0?Tt(o):(typeof(t==null?void 0:t.encounterDuration)=="string"?t.encounterDuration.trim():"")||"--:--"},Ln=(e,t)=>{if((Array.isArray(e==null?void 0:e.players)?e.players:[]).length>0)return De(e);if(typeof(e==null?void 0:e.success)=="boolean")return e.success;const M=t==null?void 0:t.dashboardSummary;if(M&&typeof M=="object"){if(M.isWin===!0)return!0;if(M.isWin===!1)return!1}return null},Rs=(e,t)=>{var C,Z;const o=Oe((C=e.log)==null?void 0:C.details,e.log),M=Oe((Z=t.log)==null?void 0:Z.details,t.log),r=o>0,_=M>0;return r&&_&&o!==M?o-M:r!==_?r?-1:1:e.originalIndex-t.originalIndex},Kt=i.map((e,t)=>({log:e,originalIndex:t})).sort(Rs),Os=Kt.filter(({log:e})=>pe(e)),Gt={};y.forEach(e=>{const t=ct(e==null?void 0:e.details,e);Gt[t]=(Gt[t]||0)+1});const Hs=Object.entries(Gt).map(([e,t])=>{const o=String(e).trim(),M=/eternal battlegrounds|^ebg$/i.test(o);let r="#64748b";return M?r="#ffffff":/red/i.test(o)?r="#ef4444":/blue/i.test(o)?r="#3b82f6":/green/i.test(o)&&(r="#22c55e"),{name:e,value:t,color:r}}).sort((e,t)=>t.value-e.value),{boonTables:js}=jn(y),Ws=(()=>{const e=a=>String(a||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),t=a=>e(a).toLowerCase().split(/[^a-z0-9]+/i).map(c=>c.trim()).filter(Boolean).map(c=>c.length>3&&c.endsWith("s")?c.slice(0,-1):c),o=(a,c)=>{const x=e(a),d=e(c);if(!d)return x;if(!x)return d;const L=t(x),$=t(d),X=new Set(L),g=new Set($),p=$.length>0&&$.every(B=>X.has(B)),k=L.length>0&&L.every(B=>g.has(B));return p||k?x:`${x} - ${d}`},M=new Map,r=(a,c)=>{if(!M.has(a))M.set(a,{id:a,name:String((c==null?void 0:c.name)||a),icon:c==null?void 0:c.icon,stacking:!!(c!=null&&c.stacking),players:new Map,fights:[]});else if(c){const x=M.get(a);(!x.name||x.name===a)&&(c!=null&&c.name)&&(x.name=String(c.name)),!x.icon&&(c!=null&&c.icon)&&(x.icon=String(c.icon)),!x.stacking&&(c!=null&&c.stacking)&&(x.stacking=!0)}return M.get(a)},_=a=>Array.isArray(a)?a.map(c=>Array.isArray(c)?[Number(c[0]),Number(c[1])]:c&&typeof c=="object"?[Number(c.time),Number(c.value)]:null).filter(c=>!!c&&Number.isFinite(c[0])&&Number.isFinite(c[1])&&c[0]>=0).sort((c,x)=>c[0]-x[0]):[],C=(a,c,x)=>{const d=a.get(c)||[];d.length<x&&(d.length=x);for(let L=0;L<x;L+=1)Number.isFinite(d[L])||(d[L]=0);return a.set(c,d),d},Z=(a,c,x,d,L)=>{if(!c||c==="__all__"||d<=0)return;const $=_(x);if($.length===0)return;const X=C(a,c,d),g=Math.max(1,Number(L||0),d*5e3),p=A=>Math.max(0,Math.min(g,Number(A||0))),k=(A,l,P)=>{if(!Number.isFinite(P)||P<=0)return;let q=p(A);const s=p(l);if(!(s<=q))for(;q<s;){const u=Math.max(0,Math.min(d-1,Math.floor(q/5e3))),O=Math.min(s,(u+1)*5e3),J=Math.max(0,O-q);J>0&&(X[u]=Number(X[u]||0)+J*P),q=O}};let B=p($[0][0]),v=Math.max(0,Number($[0][1]||0));for(let A=1;A<$.length;A+=1){const[l,P]=$[A],q=p(l);k(B,q,v),B=q,v=Math.max(0,Number(P||0))}k(B,g,v)},K=(a,c,x)=>{const d=Array.from({length:x},(X,g)=>Number((a==null?void 0:a[g])||0)),L=d.reduce((X,g)=>X+Number(g||0),0);if(!Number.isFinite(c)||c<=0)return d.map(()=>0);if(!Number.isFinite(L)||L<=0){const X=c/Math.max(1,x);return d.map(()=>X)}const $=c/L;return d.map(X=>Number(X||0)*$)},te=()=>({selfBuffs:0,groupBuffs:0,squadBuffs:0,totalBuffs:0}),F=(a,c,x)=>{const d=Math.max(0,Number(x||0));d&&(a[c]=Number(a[c]||0)+d,(c==="selfBuffs"||c==="squadBuffs")&&(a.totalBuffs=Number(a.totalBuffs||0)+d))};return y.map(a=>({log:a,ts:Oe(a==null?void 0:a.details,a)})).sort((a,c)=>a.ts-c.ts).forEach(({log:a},c)=>{const x=a==null?void 0:a.details;if(!x)return;const L=(Array.isArray(x.players)?x.players:[]).filter(u=>!(u!=null&&u.notInSquad)),$=L.length;if($<=0)return;const X=Math.max(0,Number((x==null?void 0:x.durationMS)||0)),g=Math.max(1,Math.ceil(Math.max(1,X)/5e3)),p=x!=null&&x.buffMap&&typeof x.buffMap=="object"?x.buffMap:{},k=new Map,B=new Map;L.forEach(u=>{const O=Number((u==null?void 0:u.group)??0);B.set(O,(B.get(O)||0)+1);const f=String((u==null?void 0:u.account)||(u==null?void 0:u.name)||"Unknown");[u==null?void 0:u.name,u==null?void 0:u.display_name,u==null?void 0:u.character_name,u==null?void 0:u.account].map(n=>String(n||"").trim()).filter(Boolean).forEach(n=>k.set(n,f))});const v=e(x.fightName||a.fightName||`Fight ${c+1}`),A=ct(x,a),l=o(v,String(A||"")),P=new Map,q=new Map,s=new Map;L.forEach(u=>{const O=String((u==null?void 0:u.account)||(u==null?void 0:u.name)||"Unknown"),J=String((u==null?void 0:u.profession)||"Unknown"),f=O,n=Number((u==null?void 0:u.group)??0),ee=Math.max(1,Number(B.get(n)||1));["selfBuffs","groupBuffs","squadBuffs"].forEach(h=>{(Array.isArray(u==null?void 0:u[h])?u[h]:[]).forEach(j=>{var Xe;const U=Number(j==null?void 0:j.id);if(!Number.isFinite(U))return;const w=`b${U}`,W=p[w]||{},V=String((W==null?void 0:W.classification)||"");if(V&&V!=="Boon")return;const ne=Number(((Xe=Rt(u,h,U,X,ee,$,p))==null?void 0:Xe.generationMs)||0);if(!Number.isFinite(ne)||ne<=0)return;const ie=r(w,W),le=ie.players.get(f)||{key:f,account:O,displayName:O,profession:J,professionList:J&&J!=="Unknown"?[J]:[],logs:0,totals:te()};J&&J!=="Unknown"&&!le.professionList.includes(J)&&le.professionList.push(J),(!le.profession||le.profession==="Unknown")&&J&&J!=="Unknown"&&(le.profession=J);const ke=s.get(w)||new Set;ke.has(f)||(ke.add(f),le.logs+=1,s.set(w,ke)),F(le.totals,h,ne),ie.players.set(f,le);const Ae=ie.players.get("__all__")||{key:"__all__",account:"All",displayName:"All",profession:"All",professionList:[],logs:0,totals:te()};F(Ae.totals,h,ne),ie.players.set("__all__",Ae);const Le=P.get(w)||new Map,Me=Le.get(f)||te();F(Me,h,ne),Le.set(f,Me);const Re=Le.get("__all__")||te();F(Re,h,ne),Le.set("__all__",Re),P.set(w,Le);const qe=Array.isArray(u==null?void 0:u.buffUptimes)?u.buffUptimes.find(_e=>Number(_e==null?void 0:_e.id)===U):null,ve=qe!=null&&qe.statesPerSource&&typeof qe.statesPerSource=="object"?qe.statesPerSource:null;if(ve){const _e=q.get(w)||new Map;Object.entries(ve).forEach(([Je,lt])=>{const ut=k.get(String(Je||"").trim());ut&&Z(_e,ut,lt,g,X)}),q.set(w,_e)}})})}),P.forEach((u,O)=>{const J=M.get(O);if(!J)return;const f=q.get(O)||new Map,n={};let ee=Array.from({length:g},()=>0),b=0;u.forEach((U,w)=>{const W={selfBuffs:Number((U==null?void 0:U.selfBuffs)||0),groupBuffs:Number((U==null?void 0:U.groupBuffs)||0),squadBuffs:Number((U==null?void 0:U.squadBuffs)||0),totalBuffs:Number((U==null?void 0:U.totalBuffs)||0)},V=Math.max(0,Number(W.totalBuffs||0));if(!Number.isFinite(V)||V<=0)return;const ne=f.get(w)||[],ie=K(ne,V,g);n[w]={total:V,totals:W,bucketWeights5s:Array.from({length:g},(le,ke)=>Number(ne[ke]||0)),buckets5s:ie},w!=="__all__"&&(V>b&&(b=V),ee=ee.map((le,ke)=>Number(le||0)+Number(ie[ke]||0)))});const h=u.get("__all__"),H=Number((h==null?void 0:h.totalBuffs)||0);if(H>0&&(n.__all__={total:H,totals:{selfBuffs:Number((h==null?void 0:h.selfBuffs)||0),groupBuffs:Number((h==null?void 0:h.groupBuffs)||0),squadBuffs:Number((h==null?void 0:h.squadBuffs)||0),totalBuffs:Number((h==null?void 0:h.totalBuffs)||0)},bucketWeights5s:Array.from({length:g},(U,w)=>Number((f.get("__all__")||[])[w]||0)),buckets5s:ee.some(U=>Number(U||0)>0)?ee:K(f.get("__all__")||[],H,g)}),Object.keys(n).length===0)return;const j=J.players.get("__all__");j&&(j.logs+=1,J.players.set("__all__",j)),J.fights.push({id:a.filePath||a.id||`fight-${c+1}`,shortLabel:`F${c+1}`,fullLabel:l,timestamp:Oe(x,a),durationMs:X,values:n,maxTotal:b})})}),Array.from(M.values()).map(a=>({id:a.id,name:a.name||a.id,icon:a.icon,stacking:a.stacking,players:Array.from(a.players.values()).sort((c,x)=>{var L,$;if(c.key==="__all__")return-1;if(x.key==="__all__")return 1;const d=Number(((L=x.totals)==null?void 0:L.totalBuffs)||0)-Number((($=c.totals)==null?void 0:$.totalBuffs)||0);return d!==0?d:String(c.displayName||"").localeCompare(String(x.displayName||""))}),fights:[...a.fights].sort((c,x)=>c.timestamp>0&&x.timestamp>0&&c.timestamp!==x.timestamp?c.timestamp-x.timestamp:c.shortLabel.localeCompare(x.shortLabel,void 0,{numeric:!0}))})).filter(a=>a.players.length>0&&a.fights.length>0).sort((a,c)=>String(a.name||"").localeCompare(String(c.name||"")))})(),zs=(()=>{const e=F=>String(F||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),t=F=>e(F).toLowerCase().split(/[^a-z0-9]+/i).map(a=>a.trim()).filter(Boolean).map(a=>a.length>3&&a.endsWith("s")?a.slice(0,-1):a),o=(F,a)=>{const c=e(F),x=e(a);if(!x)return c;if(!c)return x;const d=t(c),L=t(x),$=new Set(d),X=new Set(L),g=L.length>0&&L.every(k=>$.has(k)),p=d.length>0&&d.every(k=>X.has(k));return g||p?c:`${c} - ${x}`},M=new Map,r=(F,a)=>{if(!M.has(F))M.set(F,{id:F,name:String((a==null?void 0:a.name)||F),icon:a==null?void 0:a.icon,stacking:!!(a!=null&&a.stacking),players:new Map,fights:[]});else if(a){const c=M.get(F);(!c.name||c.name===F)&&(a!=null&&a.name)&&(c.name=String(a.name)),!c.icon&&(a!=null&&a.icon)&&(c.icon=String(a.icon)),!c.stacking&&(a!=null&&a.stacking)&&(c.stacking=!0)}return M.get(F)},_=F=>Array.isArray(F)?F.map(a=>Array.isArray(a)?[Number(a[0]),Number(a[1])]:a&&typeof a=="object"?[Number(a.time),Number(a.value)]:null).filter(a=>!!a&&Number.isFinite(a[0])&&Number.isFinite(a[1])&&a[0]>=0).sort((a,c)=>a[0]-c[0]):[],C=(F,a)=>{if(!a)return 1;const c=String(F||"").trim().toLowerCase();return 25},Z=(F,a,c)=>{const x=Number.isFinite(F)?Math.max(0,F):0;return a?Math.max(0,Math.min(c,Math.round(x))):x>0?1:0},K=(F,a,c,x)=>{const d=Array.from({length:a},()=>0);if(!F||typeof F!="object"||a<=0)return d;Object.values(F).forEach($=>{const X=_($);if(X.length===0)return;let g=0,p=0;for(let k=0;k<a;k+=1){const B=k*5e3;for(;g<X.length&&X[g][0]<=B;)p=Math.max(0,Number(X[g][1]||0)),g+=1;d[k]+=Math.max(0,Number(p||0))}});const L=C(x,c);return d.map($=>Z($,c,L))},te=F=>{const a=F.reduce((x,d)=>x+Math.max(0,Number(d||0)),0),c=F.reduce((x,d)=>Math.max(x,Math.max(0,Number(d||0))),0);return{total:a,peak:c,buckets5s:F}};return y.map(F=>({log:F,ts:Oe(F==null?void 0:F.details,F)})).sort((F,a)=>F.ts-a.ts).forEach(({log:F},a)=>{const c=F==null?void 0:F.details;if(!c)return;const d=(Array.isArray(c.players)?c.players:[]).filter(A=>!(A!=null&&A.notInSquad));if(d.length<=0)return;const L=Math.max(0,Number((c==null?void 0:c.durationMS)||0)),$=Math.max(1,Math.ceil(Math.max(1,L)/5e3)),X=c!=null&&c.buffMap&&typeof c.buffMap=="object"?c.buffMap:{},g=e(c.fightName||F.fightName||`Fight ${a+1}`),p=ct(c,F),k=o(g,String(p||"")),B=new Map,v=new Map;d.forEach(A=>{const l=String((A==null?void 0:A.account)||(A==null?void 0:A.name)||"Unknown"),P=l,q=String((A==null?void 0:A.profession)||"Unknown");(Array.isArray(A==null?void 0:A.buffUptimes)?A.buffUptimes:[]).forEach(u=>{const O=Number(u==null?void 0:u.id);if(!Number.isFinite(O))return;const J=`b${O}`,f=X[J]||{},n=String((f==null?void 0:f.classification)||"");if(n&&n!=="Boon")return;const ee=u!=null&&u.statesPerSource&&typeof u.statesPerSource=="object"?u.statesPerSource:null;if(!ee)return;const b=K(ee,$,!!(f!=null&&f.stacking),String((f==null?void 0:f.name)||"")),h=te(b);if(h.total<=0&&h.peak<=0)return;const H=r(J,f),j=H.players.get(P)||{key:P,account:l,displayName:l,profession:q,professionList:q&&q!=="Unknown"?[q]:[],logs:0,total:0,peak:0};q&&q!=="Unknown"&&!j.professionList.includes(q)&&j.professionList.push(q),(!j.profession||j.profession==="Unknown")&&q&&q!=="Unknown"&&(j.profession=q);const U=v.get(J)||new Set;U.has(P)||(U.add(P),j.logs+=1,v.set(J,U)),j.total+=h.total,j.peak=Math.max(j.peak,h.peak),H.players.set(P,j);const w=B.get(J)||new Map;w.set(P,h),B.set(J,w)})}),B.forEach((A,l)=>{const P=M.get(l);if(!P)return;const q={};let s=0;A.forEach((u,O)=>{q[O]={total:Number(u.total||0),peak:Number(u.peak||0),buckets5s:Array.isArray(u.buckets5s)?u.buckets5s.map(J=>Number(J||0)):[]},s=Math.max(s,Number(u.peak||0))}),Object.keys(q).length!==0&&P.fights.push({id:F.filePath||F.id||`fight-${a+1}`,shortLabel:`F${a+1}`,fullLabel:k,timestamp:Oe(c,F),durationMs:L,values:q,maxTotal:s})})}),Array.from(M.values()).map(F=>({id:F.id,name:F.name||F.id,icon:F.icon,stacking:F.stacking,players:Array.from(F.players.values()).sort((a,c)=>{const x=Number(c.peak||0)-Number(a.peak||0);if(x!==0)return x;const d=Number(c.total||0)-Number(a.total||0);return d!==0?d:String(a.displayName||"").localeCompare(String(c.displayName||""))}),fights:[...F.fights].sort((a,c)=>a.timestamp>0&&c.timestamp>0&&a.timestamp!==c.timestamp?a.timestamp-c.timestamp:a.shortLabel.localeCompare(c.shortLabel,void 0,{numeric:!0}))})).filter(F=>F.players.length>0&&F.fights.length>0).sort((F,a)=>String(F.name||"").localeCompare(String(a.name||"")))})(),Vs=Kt.map(({log:e})=>{const t=e==null?void 0:e.details,o=Array.isArray(t==null?void 0:t.players)?t.players:[],M=Array.isArray(t==null?void 0:t.targets)?t.targets:[],r=e!=null&&e.dashboardSummary&&typeof e.dashboardSummary=="object"?e.dashboardSummary:null,_=o.filter(c=>!c.notInSquad),C=M.filter(c=>!c.isFake),Z=Math.max(0,Number((r==null?void 0:r.squadCount)||0)),K=Math.max(0,Number((r==null?void 0:r.enemyCount)||0)),te=_.length>0?_.length:Z,F=C.length>0?C.length:K,a=o.length>0?o.length:te;return{timestamp:Oe(t,e),squadCount:te,friendlyCount:a,enemies:F,isWin:Ln(t,e)}}).map((e,t)=>({...e,index:t+1,label:`Log ${t+1}`})),Jt={};Array.from(me.values()).forEach(e=>{e.profession&&e.profession!=="Unknown"&&(Jt[e.profession]=(Jt[e.profession]||0)+1)});const Ks=Object.entries(Jt).map(([e,t])=>({name:e,value:t,color:fn(e)})).sort((e,t)=>t.value-e.value),Yt={};Object.keys(xe).length===0&&y.forEach(e=>{var t,o;(o=(t=e.details)==null?void 0:t.targets)==null||o.forEach(M=>{if(M.isFake)return;const r=M.profession&&M.profession!=="Unknown"?M.profession:M.name||M.id||"Unknown",_=tt(r);Yt[_]=(Yt[_]||0)+1})});const Gs=Object.keys(xe).length>0?xe:Yt,Js=Object.entries(Gs).map(([e,t])=>({name:e,value:t,color:fn(e)})).sort((e,t)=>t.value-e.value),Ys=Kt.map(({log:e},t)=>{const o=e==null?void 0:e.details,M=Array.isArray(o==null?void 0:o.players)?o.players:[],r=M.filter(l=>!l.notInSquad),_=M.filter(l=>l.notInSquad),Z=(Array.isArray(o==null?void 0:o.targets)?o.targets:[]).filter(l=>!l.isFake),K=e!=null&&e.dashboardSummary&&typeof e.dashboardSummary=="object"?e.dashboardSummary:null,te=r.reduce((l,P)=>{var q,s;return l+(((s=(q=P.dpsAll)==null?void 0:q[0])==null?void 0:s.damage)||0)},0),F=r.reduce((l,P)=>{var q,s;return l+(((s=(q=P.defenses)==null?void 0:q[0])==null?void 0:s.damageTaken)||0)},0),{enemyDeaths:a,enemyDownsDeaths:c}=Se(o),x=Ln(o,e),d=Oe(o,e),L=ct(o,e),$=l=>{if(!l||typeof l!="object")return;const P=l.teamID??l.teamId??l.team??l.teamColor??l.team_color;if(P!=null)return P;const q=Object.keys(l).find(s=>/^team/i.test(s));return q?l[q]:void 0},X=(l,P)=>{const q={};return l.forEach(s=>{const u=P(s),O=tt(u);O&&(q[O]=(q[O]||0)+1)}),q},g=X(r,l=>(l==null?void 0:l.profession)||(l==null?void 0:l.name)),p=X(_,l=>(l==null?void 0:l.profession)||(l==null?void 0:l.name)),k=X(Z,l=>(l==null?void 0:l.profession)||(l==null?void 0:l.name)||(l==null?void 0:l.id)),B=new Set;r.forEach(l=>{const P=$(l);P!=null&&B.add(String(P))});const v=new Map;Z.forEach(l=>{if((l==null?void 0:l.enemyPlayer)===!1)return;const P=$(l);if(P==null)return;const q=String(P);B.has(q)||v.set(q,(v.get(q)||0)+1)});const A=Array.from(v.entries()).sort((l,P)=>{const q=P[1]-l[1];return q!==0?q:l[0].localeCompare(P[0],void 0,{numeric:!0})}).slice(0,3).map(([l,P])=>({teamId:l,count:P}));return{id:e.filePath||`fight-${t}`,label:e.encounterName||`Fight ${t+1}`,permalink:_s(o,e),timestamp:d,mapName:L,duration:$s(o,e),isWin:x,squadCount:r.length>0?r.length:Math.max(0,Number((K==null?void 0:K.squadCount)||0)),allyCount:_.length,enemyCount:Z.length>0?Z.length:Math.max(0,Number((K==null?void 0:K.enemyCount)||0)),teamBreakdown:A,alliesDown:r.reduce((l,P)=>{var q,s;return l+(((s=(q=P.defenses)==null?void 0:q[0])==null?void 0:s.downCount)||0)},0),alliesDead:r.length>0?r.reduce((l,P)=>{var q,s;return l+(((s=(q=P.defenses)==null?void 0:q[0])==null?void 0:s.deadCount)||0)},0):Math.max(0,Number((K==null?void 0:K.squadDeaths)||0)),alliesRevived:r.reduce((l,P)=>{var q,s;return Number(((s=(q=P.statsAll)==null?void 0:q[0])==null?void 0:s.saved)||0)>0?l+1:l},0),rallies:0,enemyDeaths:Z.length>0||r.length>0?a:Math.max(0,Number((K==null?void 0:K.enemyDeaths)||0)),enemyDowns:Math.max(0,c-a),totalOutgoingDamage:te,totalIncomingDamage:F,incomingBarrierAbsorbed:r.reduce((l,P)=>{var q,s;return l+(((s=(q=P.defenses)==null?void 0:q[0])==null?void 0:s.damageBarrier)||0)},0),outgoingBarrierAbsorbed:r.reduce((l,P)=>{var u;const q=(u=P.extBarrierStats)==null?void 0:u.outgoingBarrier;if(!Array.isArray(q))return l;let s=0;return q.forEach(O=>{if(Array.isArray(O)){O.forEach(J=>{s+=Number((J==null?void 0:J.barrier)||0)});return}s+=Number((O==null?void 0:O.barrier)||0)}),l+s},0),squadClassCountsFight:g,allyClassCountsFight:p,enemyClassCounts:k}}),Qs=Os.map(({log:e},t)=>{const o=e.details;if(!o)return null;const r=(Array.isArray(o.players)?o.players:[]).filter(b=>!b.notInSquad),_=Array.isArray(o.targets)?o.targets:[],C=Oe(o,e),Z=ct(o,e),K=Number(o.durationMS||0),{squadDownsDeaths:te,enemyDownsDeaths:F,squadDeaths:a,enemyDeaths:c}=Se(o),x=new Map,d=(b,h,H)=>{const j=x.get(b)||{label:b,damage:0,hits:0};j.damage+=h,j.hits+=H,x.set(b,j)};if(r.forEach(b=>{(Array.isArray(b==null?void 0:b.statsTargets)?b.statsTargets:[]).forEach((H,j)=>{const U=Array.isArray(H)?H[0]:H,w=Number((U==null?void 0:U.damage)??(U==null?void 0:U.totalDmg)??(U==null?void 0:U.connectedDmg)??0),W=Number((U==null?void 0:U.connectedHits)??(U==null?void 0:U.connectedDamageCount)??(U==null?void 0:U.hits)??0);if(w<=0&&W<=0)return;const V=_[j];if(V!=null&&V.isFake)return;const ne=(V==null?void 0:V.profession)||(V==null?void 0:V.name)||(V==null?void 0:V.id)||`Target ${j+1}`,ie=tt(ne);d(ie||String(ne),w,W)})}),x.size===0){const b=new Map,h=H=>{if(!Array.isArray(H)||H.length===0)return[];const j=H[0];if(Array.isArray(j)&&Array.isArray(j[0])){if(typeof j[0][0]=="number")return j;if(Array.isArray(j[0])&&typeof j[0][0]=="number")return H.map(U=>Array.isArray(U)?U[0]||[]:[])}return[]};r.forEach(H=>{h(H==null?void 0:H.targetDamage1S).forEach((U,w)=>{if(!Array.isArray(U)||U.length===0)return;const W=U.map(ne=>Number(ne)).filter(ne=>Number.isFinite(ne)&&ne>=0);if(W.length===0)return;const V=Math.max(0,W[W.length-1]||0);V<=0||b.set(w,(b.get(w)||0)+V)})}),b.forEach((H,j)=>{if(H<=0)return;const U=_[j];if(U!=null&&U.isFake)return;const w=(U==null?void 0:U.profession)||(U==null?void 0:U.name)||(U==null?void 0:U.id)||`Target ${j+1}`,W=tt(w);d(W||String(w),H,0)})}if(x.size===0&&_.forEach((b,h)=>{if(b!=null&&b.isFake)return;const H=Array.isArray(b==null?void 0:b.totalDamageTaken)?b.totalDamageTaken:Array.isArray(b==null?void 0:b.totalDamageDist)?b.totalDamageDist:[];let j=0,U=0;if(H.forEach(V=>{j+=Number((V==null?void 0:V.totalDamage)||(V==null?void 0:V.damage)||0),U+=Number((V==null?void 0:V.connectedHits)||(V==null?void 0:V.hits)||0)}),j<=0&&Number((b==null?void 0:b.damageTaken)||0)>0&&(j=Number(b.damageTaken||0)),j<=0&&U<=0)return;const w=(b==null?void 0:b.profession)||(b==null?void 0:b.name)||(b==null?void 0:b.id)||`Target ${h+1}`,W=tt(w);d(W||String(w),j,U)}),x.size===0){const b=new Map;_.forEach((h,H)=>{if(h!=null&&h.isFake)return;const j=(h==null?void 0:h.profession)||(h==null?void 0:h.name)||(h==null?void 0:h.id)||`Target ${H+1}`,U=tt(j)||String(j);b.set(U,(b.get(U)||0)+1)}),b.forEach((h,H)=>{h>0&&d(H,h,0)})}const L=Array.from(x.values()).sort((b,h)=>h.damage-b.damage||h.hits-b.hits||b.label.localeCompare(h.label)),$=L.reduce((b,h)=>b+h.damage,0),X=L.map(b=>({label:b.label,damage:b.damage,hits:b.hits,share:$>0?b.damage/$:0})),g=_.filter(b=>!(b!=null&&b.isFake)).length,p=r.length,k=r.reduce((b,h)=>{var H,j;return b+Number(((j=(H=h==null?void 0:h.dpsAll)==null?void 0:H[0])==null?void 0:j.damage)||0)},0),B=r.reduce((b,h)=>{var H,j;return b+Number(((j=(H=h==null?void 0:h.defenses)==null?void 0:H[0])==null?void 0:j.damageTaken)||0)},0),v=r.reduce((b,h)=>{var H,j;return b+Number(((j=(H=h==null?void 0:h.defenses)==null?void 0:H[0])==null?void 0:j.damageBarrier)||0)},0),A=r.reduce((b,h)=>{var U;const H=(U=h==null?void 0:h.extBarrierStats)==null?void 0:U.outgoingBarrier;if(!Array.isArray(H))return b;let j=0;return H.forEach(w=>{Array.isArray(w)?w.forEach(W=>{j+=Number((W==null?void 0:W.barrier)||0)}):j+=Number((w==null?void 0:w.barrier)||0)}),b+j},0),l=r.reduce((b,h)=>{var H,j;return Number(((j=(H=h==null?void 0:h.statsAll)==null?void 0:H[0])==null?void 0:j.saved)||0)>0?b+1:b},0),P=r.reduce((b,h)=>b+Number(sn(h)||0),0),q=r.reduce((b,h)=>b+Number(on(h)||0),0),s=r.reduce((b,h)=>b+Number((h==null?void 0:h.stabGeneration)||0),0),u=r.reduce((b,h)=>b+Number(rn(h)||0),0),O=r.reduce((b,h)=>b+Number(cn(h)||0),0),J=r.reduce((b,h)=>b+Number(un(h)||0),0),f=r.reduce((b,h)=>b+Number(an(h)||0),0),n=a>0?c/a:c,ee=[{metricId:"winFlag",metricLabel:"Win (1) / Loss (0)",higherIsBetter:!0,value:De(o)?1:0},{metricId:"squadCount",metricLabel:"Squad Size",higherIsBetter:!0,value:p},{metricId:"enemyCount",metricLabel:"Enemy Count",higherIsBetter:!1,value:g},{metricId:"squadKdr",metricLabel:"Squad KDR",higherIsBetter:!0,value:n},{metricId:"enemyDeaths",metricLabel:"Enemy Deaths",higherIsBetter:!0,value:c},{metricId:"enemyDowns",metricLabel:"Enemy Downs",higherIsBetter:!0,value:Math.max(0,F-c)},{metricId:"squadDeaths",metricLabel:"Squad Deaths",higherIsBetter:!1,value:a},{metricId:"squadDowns",metricLabel:"Squad Downs",higherIsBetter:!1,value:Math.max(0,te-a)},{metricId:"damageDelta",metricLabel:"Damage Delta",higherIsBetter:!0,value:k-B},{metricId:"outgoingDamage",metricLabel:"Outgoing Damage",higherIsBetter:!0,value:k},{metricId:"incomingDamage",metricLabel:"Incoming Damage",higherIsBetter:!1,value:B},{metricId:"cleanses",metricLabel:"Squad Cleanses",higherIsBetter:!0,value:P},{metricId:"strips",metricLabel:"Squad Strips",higherIsBetter:!0,value:q},{metricId:"stability",metricLabel:"Squad Stability",higherIsBetter:!0,value:s},{metricId:"healing",metricLabel:"Squad Healing",higherIsBetter:!0,value:u},{metricId:"barrierOut",metricLabel:"Squad Barrier Out",higherIsBetter:!0,value:O},{metricId:"barrierIncomingAbsorb",metricLabel:"Barrier Absorption (Incoming)",higherIsBetter:!0,value:v},{metricId:"enemyBarrierAbsorb",metricLabel:"Enemy Barrier Absorption",higherIsBetter:!1,value:A},{metricId:"cc",metricLabel:"Squad CC",higherIsBetter:!0,value:J},{metricId:"downContrib",metricLabel:"Squad Down Contribution",higherIsBetter:!0,value:f},{metricId:"alliesRevived",metricLabel:"Allies Revived (Players)",higherIsBetter:!0,value:l}];return{id:e.filePath||e.id||`fight-${t+1}`,shortLabel:`F${t+1}`,fullLabel:`${Z||e.encounterName||"Unknown Map"} • ${Tt(K)}`,mapName:Z,timestamp:C,duration:Tt(K),isWin:De(o),targetFocus:X,squadMetrics:ee}}).filter(Boolean),Xs=Array.from(me.values()).map(e=>{const t=Object.entries(e.professionTimeMs||{}).map(([o,M])=>({profession:o,timeMs:Number(M||0)})).filter(o=>o.profession&&o.profession!=="Unknown"&&o.timeMs>0).sort((o,M)=>{const r=M.timeMs-o.timeMs;return r!==0?r:o.profession.localeCompare(M.profession)});return{account:e.account||"Unknown",characterNames:Array.from(e.characterNames||[]).filter(Boolean).sort((o,M)=>o.localeCompare(M)),classTimes:t,combatTimeMs:Number(e.squadActiveMs||e.totalFightMs||0),squadTimeMs:(()=>{const o=Number(e.firstSeenFightTs||0),M=Number(e.lastSeenFightTs||0),r=Math.max(0,Number(e.lastSeenFightDurationMs||0));return o>0&&M>0?Math.max(0,M+r-o):Number(e.squadActiveMs||e.totalFightMs||0)})()}}).filter(e=>e.account&&e.account!=="Unknown").sort((e,t)=>{const o=t.squadTimeMs-e.squadTimeMs;return o!==0?o:String(e.account).localeCompare(String(t.account))}),Zs=y.map(e=>e).sort((e,t)=>Oe(e.details,e)-Oe(t.details,t)).map((e,t)=>{const o=e==null?void 0:e.details,M=Array.isArray(o==null?void 0:o.players)?o.players.filter(C=>!(C!=null&&C.notInSquad)):[],r=new Map;M.forEach(C=>{const Z=Number(C==null?void 0:C.group),K=Number.isFinite(Z)&&Z>0?Z:0;r.has(K)||r.set(K,{party:K,players:[],classCounts:{}});const te=tt((C==null?void 0:C.profession)||(C==null?void 0:C.name)||"Unknown"),F=String((C==null?void 0:C.account)||"Unknown"),a=String((C==null?void 0:C.name)||(C==null?void 0:C.character_name)||""),c=!!(C!=null&&C.hasCommanderTag),x=r.get(K);x.players.push({account:F,characterName:a,profession:te,isCommander:c}),x.classCounts[te]=(x.classCounts[te]||0)+1});const _=Array.from(r.values()).map(C=>({...C,players:C.players.sort((Z,K)=>{const te=+!!K.isCommander-+!!Z.isCommander;if(te!==0)return te;const F=String(Z.profession).localeCompare(String(K.profession));return F!==0?F:String(Z.account).localeCompare(String(K.account))})})).sort((C,Z)=>C.party===0&&Z.party!==0?1:Z.party===0&&C.party!==0?-1:C.party-Z.party);return{id:String((e==null?void 0:e.filePath)||(e==null?void 0:e.id)||`fight-${t+1}`),label:`F${t+1}`,timestamp:Oe(o,e),mapName:ct(o,e),duration:Tt(Number((o==null?void 0:o.durationMS)||0)),parties:_}}),ys=(e,t)=>{const o=(t==null?void 0:t.skillMap)||{},M=(t==null?void 0:t.buffMap)||{};let r=0,_=0,C="";const Z=F=>{const a=Number(F);if(!Number.isFinite(a))return String(F||"Unknown Skill");const c=(o==null?void 0:o[`s${a}`])||(o==null?void 0:o[`${a}`]);if(c!=null&&c.name)return String(c.name);const x=(M==null?void 0:M[`b${a}`])||(M==null?void 0:M[`${a}`]);return x!=null&&x.name?String(x.name):`Skill ${a}`},K=F=>{if(!F||typeof F!="object")return;const a=[Number(F.max),Number(F.maxDamage),Number(F.maxHit)].filter(d=>Number.isFinite(d)),c=a.length>0?Math.max(...a):0;c>r&&(r=c,C=Z(F.id));const x=Number(F.downContribution||0);x>_&&(_=x)};let te=!1;return Array.isArray(e==null?void 0:e.targetDamageDist)&&e.targetDamageDist.forEach(F=>{Array.isArray(F)&&F.forEach(a=>{Array.isArray(a)&&a.forEach(c=>{te=!0,K(c)})})}),(!te||r<=0)&&Array.isArray(e==null?void 0:e.totalDamageDist)&&e.totalDamageDist.forEach(F=>{Array.isArray(F)&&F.forEach(a=>K(a))}),{peak:r,peakDownContribution:_,skillName:C||"Unknown Skill"}},ei=(()=>{const e=d=>String(d||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),t=d=>e(d).toLowerCase().split(/[^a-z0-9]+/i).map(L=>L.trim()).filter(Boolean).map(L=>L.length>3&&L.endsWith("s")?L.slice(0,-1):L),o=(d,L)=>{const $=e(d),X=e(L);if(!X)return $;if(!$)return X;const g=t($),p=t(X),k=new Set(g),B=new Set(p),v=p.length>0&&p.every(l=>k.has(l)),A=g.length>0&&g.every(l=>B.has(l));return v||A?$:`${$} - ${X}`},M=[],r=new Map,_=d=>{const L=v=>{if(!Array.isArray(v)||v.length===0)return[];const A=[];for(let l=0;l<v.length;l+=1){const P=Number(v[l]||0),q=l>0?Number(v[l-1]||0):0;A.push(Math.max(0,P-q))}return A},$=v=>{if(!Array.isArray(v))return[];const A=v.reduce((P,q)=>Math.max(P,Array.isArray(q)?q.length:0),0);if(A<=0)return[];const l=new Array(A).fill(0);return v.forEach(P=>{if(Array.isArray(P))for(let q=0;q<A;q+=1)l[q]+=Number(P[q]||0)}),l},X=v=>Array.isArray(v)?v.map(A=>Number(A||0)):null,p=(v=>{if(!Array.isArray(v)||v.length===0)return null;const A=v[0];if(!Array.isArray(A))return null;if(Array.isArray(A[0])&&Array.isArray(A[0][0]))return $(A);if(Array.isArray(A[0])&&!Array.isArray(A[0][0])){const l=v.map(P=>X(Array.isArray(P)?P[0]:null)).filter(P=>Array.isArray(P)&&P.length>0);if(l.length>0)return $(l)}return null})(d==null?void 0:d.targetDamage1S),k=Array.isArray(d==null?void 0:d.damage1S)&&Array.isArray(d.damage1S[0])?d.damage1S[0]:null,B=p||(Array.isArray(k)?k.map(v=>Number(v||0)):[]);return L(B)},C=(d,L)=>{if(!Array.isArray(d)||d.length===0||L<=0)return 0;let $=0,X=0;for(let g=0;g<d.length;g+=1)$+=Number(d[g]||0),g>=L&&($-=Number(d[g-L]||0)),g>=L-1&&$>X&&(X=$);return Math.max(0,X)},Z=(d,L)=>{if(!Array.isArray(d)||d.length===0||L<=0)return[];const $=[];for(let X=0;X<d.length;X+=L){const g=Math.min(X+L,d.length),p=d.slice(X,g).reduce((k,B)=>k+Number(B||0),0);$.push(p)}return $},K=(d,L)=>{let $=0,X=0;const g=new Map,p=B=>{if(!B||typeof B!="object"||B.indirectDamage)return;const v=Number(B.totalDamage||0),A=Number(B.downContribution||0);!Number.isFinite(v)&&!Number.isFinite(A)||($+=Number.isFinite(v)?v:0,X+=Number.isFinite(A)?A:0)};return Array.isArray(d==null?void 0:d.targetDamageDist)&&d.targetDamageDist.forEach(B=>{Array.isArray(B)&&B.forEach(v=>{Array.isArray(v)&&v.forEach(A=>{const l=Number(A==null?void 0:A.id);if(Number.isFinite(l)){const P=g.get(l)||{damage:0,downContribution:0};P.damage+=Number((A==null?void 0:A.totalDamage)||0),P.downContribution+=Number((A==null?void 0:A.downContribution)||0),g.set(l,P)}p(A)})})}),!(L!=null&&L.detailedWvW)&&Array.isArray(d==null?void 0:d.totalDamageDist)&&d.totalDamageDist.forEach(B=>{Array.isArray(B)&&B.forEach(v=>{const A=Number(v==null?void 0:v.id);if(!Number.isFinite(A)){p(v);return}const l=g.get(A);if(!l){p(v);return}const P=Number((v==null?void 0:v.totalDamage)||0)-Number(l.damage||0),q=Number((v==null?void 0:v.downContribution)||0)-Number(l.downContribution||0);P<=0&&q<=0||p({...v,totalDamage:Math.max(0,P),downContribution:Math.max(0,q)})})}),{damageTotal:Math.max(0,$),downContributionTotal:Math.max(0,X)}},te=(d,L)=>{const $=Number(d);if(!Number.isFinite($))return{name:String(d||"Unknown Skill"),icon:void 0};const X=(L==null?void 0:L.skillMap)||{},g=(L==null?void 0:L.buffMap)||{},p=(X==null?void 0:X[`s${$}`])||(X==null?void 0:X[`${$}`]);if(p!=null&&p.name)return{name:String(p.name),icon:p==null?void 0:p.icon};const k=(g==null?void 0:g[`b${$}`])||(g==null?void 0:g[`${$}`]);return k!=null&&k.name?{name:String(k.name),icon:k==null?void 0:k.icon}:{name:`Skill ${$}`,icon:void 0}},F=d=>Array.isArray(d)?d.map(L=>Array.isArray(L)?[Number(L[0]),Number(L[1])]:L&&typeof L=="object"?[Number(L.time),Number(L.value)]:null).filter(L=>!!L&&Number.isFinite(L[0])&&L[0]>=0):[],a=(d,L,$,X,g)=>{if(!d.length||X<=0)return[];const p=Math.max(X*5e3,g||0),k=u=>u.reduce((O,J)=>J>=0&&J<=p+2e3?O+1:O,0),B=d.map(u=>Number(u||0)).filter(u=>Number.isFinite(u)&&u>=0);if(!B.length)return[];const v=[B],A=B.reduce((u,O)=>Math.max(u,O),0),l=B.reduce((u,O)=>Math.min(u,O),Number.POSITIVE_INFINITY);A>p*20&&v.push(B.map(u=>u/1e3)),A<=p*2&&l>=0&&A>0&&A<Math.max(120,X*5+10)&&v.push(B.map(u=>u*1e3));let P=B,q=0,s=-1;return v.forEach(u=>{const O=u.reduce((f,n)=>Math.min(f,n),Number.POSITIVE_INFINITY),J=new Set([0,...L,...$]);if(Number.isFinite(O)&&p>0&&O>p){const f=Math.floor(O/p)*p;J.add(f),J.add(Math.max(0,f-p))}J.forEach(f=>{const n=u.map(b=>b-f),ee=k(n);ee>s&&(s=ee,q=f,P=u)})}),P.map(u=>u-q).filter(u=>Number.isFinite(u)&&u>=0)},c=(d,L,$,X,g)=>{const p=a(d,L,$,X,g);return Array.from(new Set(p.map(k=>Math.floor(k/5e3)).filter(k=>Number.isFinite(k)&&k>=0&&k<X)))};y.map(d=>({log:d,ts:Oe(d==null?void 0:d.details,d)})).sort((d,L)=>d.ts-L.ts).forEach(({log:d},L)=>{const $=d==null?void 0:d.details;if(!$)return;const X=e($.fightName||d.fightName||`Fight ${L+1}`),g=ct($,d),p=o(X,String(g||"")),k={},B=Array.isArray($.players)?$.players:[],v=B.flatMap(f=>{const n=f==null?void 0:f.combatReplayData;return Array.isArray(n)?n.map(ee=>Number(ee==null?void 0:ee.start)):[Number(n==null?void 0:n.start)]}).filter(f=>Number.isFinite(f)&&f>=0);B.forEach(f=>{if(f!=null&&f.notInSquad)return;const n=String((f==null?void 0:f.account)||(f==null?void 0:f.name)||"Unknown"),ee=String((f==null?void 0:f.character_name)||(f==null?void 0:f.display_name)||(f==null?void 0:f.name)||""),b=String((f==null?void 0:f.profession)||"Unknown"),h=`${n}|${b}`,H=ys(f,$),j=Number(H.peak||0),U=Number(H.peakDownContribution||0),w=_(f),{damageTotal:W,downContributionTotal:V}=K(f,$),ne=W>0?Math.min(1,Math.max(0,V/W)):0,ie=w.map(N=>Number(N||0)*ne),le=Number(C(w,1)||0),ke=Number(C(w,5)||0),Ae=Number(C(w,30)||0),Le=Number(C(ie,1)||0),Me=Number(C(ie,5)||0),Re=Number(C(ie,30)||0),qe=Math.max(0,Math.ceil(Number(($==null?void 0:$.durationMS)||0)/5e3)),ve=Math.max(0,Math.ceil(w.length/5)),Xe=Math.max(0,Math.ceil(ie.length/5)),_e=Math.max(qe,ve,Xe),Je=Z(w,5),lt=Z(ie,5),ut=Array.from({length:_e},(N,T)=>Number(Je[T]||0)),Ut=Array.from({length:_e},(N,T)=>Number(lt[T]||0)),ft=new Map,mt=N=>{if(!N||typeof N!="object"||N.indirectDamage)return;const T=Number(N.totalDamage||0),Y=Number(N.downContribution||0);if((!Number.isFinite(T)||T<=0)&&(!Number.isFinite(Y)||Y<=0))return;const ue=Number(N.connectedHits||N.hits||0),be=te(N.id,$),Fe=be.name,Be=ft.get(Fe)||{skillName:Fe,damage:0,downContribution:0,hits:0,icon:be.icon};Be.damage+=Number.isFinite(T)?T:0,Be.downContribution+=Number.isFinite(Y)?Y:0,Be.hits+=Number.isFinite(ue)?ue:0,!Be.icon&&be.icon&&(Be.icon=be.icon),ft.set(Fe,Be)},dt=new Map;Array.isArray(f==null?void 0:f.targetDamageDist)&&f.targetDamageDist.forEach(N=>{Array.isArray(N)&&N.forEach(T=>{Array.isArray(T)&&T.forEach(Y=>{const ue=Number(Y==null?void 0:Y.id),be=Number((Y==null?void 0:Y.totalDamage)||0),Fe=Number((Y==null?void 0:Y.downContribution)||0);if(Number.isFinite(ue)){const Be=dt.get(ue)||{damage:0,downContribution:0,hits:0};Be.damage+=Number.isFinite(be)?be:0,Be.downContribution+=Number.isFinite(Fe)?Fe:0,Be.hits+=Number((Y==null?void 0:Y.connectedHits)||(Y==null?void 0:Y.hits)||0),dt.set(ue,Be)}mt(Y)})})}),!($!=null&&$.detailedWvW)&&Array.isArray(f==null?void 0:f.totalDamageDist)&&f.totalDamageDist.forEach(N=>{Array.isArray(N)&&N.forEach(T=>{const Y=Number(T==null?void 0:T.id);if(!Number.isFinite(Y)){mt(T);return}const ue=dt.get(Y);if(!ue){mt(T);return}const be=Number((T==null?void 0:T.totalDamage)||0),Fe=Number((T==null?void 0:T.downContribution)||0),Be=Number((T==null?void 0:T.connectedHits)||(T==null?void 0:T.hits)||0),nt=be-Number(ue.damage||0),Ye=Fe-Number(ue.downContribution||0),et=Be-Number(ue.hits||0);nt<=0&&Ye<=0&&et<=0||mt({...T,totalDamage:Math.max(0,nt),downContribution:Math.max(0,Ye),connectedHits:Math.max(0,et),hits:Math.max(0,et)})})});const gt=(()=>{const N=f==null?void 0:f.combatReplayData;return Array.isArray(N)?N.filter(T=>T&&typeof T=="object"):N&&typeof N=="object"?[N]:[]})(),Nt=gt.map(N=>Number(N==null?void 0:N.start)).filter(N=>Number.isFinite(N)&&N>=0),_t=gt.flatMap(N=>F(N==null?void 0:N.down).map(([T])=>Number(T||0))),I=gt.flatMap(N=>F(N==null?void 0:N.dead).map(([T])=>Number(T||0)));k[h]={hit:j,burst1s:le,burst5s:ke,burst30s:Ae,hitDown:U,burst1sDown:Le,burst5sDown:Me,burst30sDown:Re,skillName:H.skillName,buckets5s:ut,buckets5sDown:Ut,downIndices5s:c(_t,Nt,v,_e,Number(($==null?void 0:$.durationMS)||0)),deathIndices5s:c(I,Nt,v,_e,Number(($==null?void 0:$.durationMS)||0)),skillRows:Array.from(ft.values()).sort((N,T)=>T.damage-N.damage).slice(0,50)};const E=r.get(h)||{key:h,account:n,displayName:n,characterName:ee,profession:b,professionList:[b],logs:0,peakHit:0,peak1s:0,peak5s:0,peak30s:0,peakHitDown:0,peak1sDown:0,peak5sDown:0,peak30sDown:0,peakFightLabel:"",peakSkillName:""};E.logs+=1,E.professionList.includes(b)||E.professionList.push(b),!E.characterName&&ee&&(E.characterName=ee),j>E.peakHit&&(E.peakHit=j,E.peakFightLabel=p,E.peakSkillName=H.skillName),le>E.peak1s&&(E.peak1s=le),ke>E.peak5s&&(E.peak5s=ke),Ae>E.peak30s&&(E.peak30s=Ae),U>E.peakHitDown&&(E.peakHitDown=U),Le>E.peak1sDown&&(E.peak1sDown=Le),Me>E.peak5sDown&&(E.peak5sDown=Me),Re>E.peak30sDown&&(E.peak30sDown=Re),r.set(h,E)});const A=Object.values(k).reduce((f,n)=>Math.max(f,Number((n==null?void 0:n.hit)||0)),0),l=Object.values(k).reduce((f,n)=>Math.max(f,Number((n==null?void 0:n.burst1s)||0)),0),P=Object.values(k).reduce((f,n)=>Math.max(f,Number((n==null?void 0:n.burst5s)||0)),0),q=Object.values(k).reduce((f,n)=>Math.max(f,Number((n==null?void 0:n.burst30s)||0)),0),s=Object.values(k).reduce((f,n)=>Math.max(f,Number((n==null?void 0:n.hitDown)||0)),0),u=Object.values(k).reduce((f,n)=>Math.max(f,Number((n==null?void 0:n.burst1sDown)||0)),0),O=Object.values(k).reduce((f,n)=>Math.max(f,Number((n==null?void 0:n.burst5sDown)||0)),0),J=Object.values(k).reduce((f,n)=>Math.max(f,Number((n==null?void 0:n.burst30sDown)||0)),0);M.push({id:d.filePath||d.id||`fight-${L+1}`,shortLabel:`F${L+1}`,fullLabel:p,timestamp:Oe($,d),values:k,maxHit:A,max1s:l,max5s:P,max30s:q,maxHitDown:s,max1sDown:u,max5sDown:O,max30sDown:J})});const x=Array.from(r.values()).sort((d,L)=>L.peakHit!==d.peakHit?L.peakHit-d.peakHit:d.displayName.localeCompare(L.displayName));return{fights:M,players:x}})(),ti=(()=>{const e=g=>String(g||"").replace(/^Detailed\s*WvW\s*-\s*/i,"").replace(/^World\s*vs\s*World\s*-\s*/i,"").replace(/^WvW\s*-\s*/i,"").trim(),t=g=>e(g).toLowerCase().split(/[^a-z0-9]+/i).map(p=>p.trim()).filter(Boolean).map(p=>p.length>3&&p.endsWith("s")?p.slice(0,-1):p),o=(g,p)=>{const k=e(g),B=e(p);if(!B)return k;if(!k)return B;const v=t(k),A=t(B),l=new Set(v),P=new Set(A),q=A.length>0&&A.every(u=>l.has(u)),s=v.length>0&&v.every(u=>P.has(u));return q||s?k:`${k} - ${B}`},M=[],r=new Map,_=(g,p)=>{const k=Number(g);if(!Number.isFinite(k))return{name:String(g||"Unknown Skill"),icon:void 0};const B=(p==null?void 0:p.skillMap)||{},v=(p==null?void 0:p.buffMap)||{},A=(B==null?void 0:B[`s${k}`])||(B==null?void 0:B[`${k}`]);if(A!=null&&A.name)return{name:String(A.name),icon:A==null?void 0:A.icon};const l=(v==null?void 0:v[`b${k}`])||(v==null?void 0:v[`${k}`]);return l!=null&&l.name?{name:String(l.name),icon:l==null?void 0:l.icon}:{name:`Skill ${k}`,icon:void 0}},C=(g,p)=>{let k=0,B="";const v=A=>{if(!A||typeof A!="object"||A.indirectDamage)return;const l=[Number(A.max),Number(A.maxDamage),Number(A.maxHit)].filter(q=>Number.isFinite(q)),P=l.length>0?Math.max(...l):0;P>k&&(k=P,B=_(A.id,p).name)};return Array.isArray(g==null?void 0:g.totalDamageDist)&&g.totalDamageDist.forEach(A=>{Array.isArray(A)&&A.forEach(l=>v(l))}),Array.isArray(g==null?void 0:g.targetDamageDist)&&g.targetDamageDist.forEach(A=>{Array.isArray(A)&&A.forEach(l=>{Array.isArray(l)&&l.forEach(P=>v(P))})}),{peak:k,skillName:B||"Unknown Skill"}},Z=g=>{if(!Array.isArray(g)||g.length===0)return[];const p=[];for(let k=0;k<g.length;k+=1){const B=Number(g[k]||0),v=k>0?Number(g[k-1]||0):0;p.push(Math.max(0,B-v))}return p},K=g=>{if(!Array.isArray(g)||g.length===0)return[];const p=g.reduce((B,v)=>Math.max(B,Array.isArray(v)?v.length:0),0);if(p<=0)return[];const k=new Array(p).fill(0);return g.forEach(B=>{if(Array.isArray(B))for(let v=0;v<p;v+=1)k[v]+=Number(B[v]||0)}),k},te=g=>{if(!Array.isArray(g)||g.length===0)return[];const p=g[0];if(typeof p=="number")return g.map(k=>Number(k||0));if(Array.isArray(p)&&p.length>0){if(typeof p[0]=="number")return p.map(k=>Number(k||0));if(Array.isArray(p[0])){const k=p.map(B=>Array.isArray(B)?B.map(v=>Number(v||0)):null).filter(B=>Array.isArray(B)&&B.length>0);if(k.length>0)return K(k)}}return[]},F=g=>{const p=te(g==null?void 0:g.powerDamage1S),k=te(g==null?void 0:g.damage1S),B=p.length>0?p:k;return Z(B)},a=(g,p)=>{const k=g==null?void 0:g.targetPowerDamage1S;if(!Array.isArray(k)||!Array.isArray(k[p]))return[];const B=k[p];if(!Array.isArray(B)||B.length===0)return[];if(typeof B[0]=="number")return B.map(v=>Number(v||0));if(Array.isArray(B[0])&&!Array.isArray(B[0][0]))return B[0].map(v=>Number(v||0));if(Array.isArray(B[0])&&Array.isArray(B[0][0])){const A=B[0].map(l=>Array.isArray(l)?l.map(P=>Number(P||0)):null).filter(l=>Array.isArray(l)&&l.length>0);return K(A)}return[]},c=(g,p)=>{if(!Array.isArray(g)||g.length===0||p<=0)return 0;let k=0,B=0;for(let v=0;v<g.length;v+=1)k+=Number(g[v]||0),v>=p&&(k-=Number(g[v-p]||0)),v>=p-1&&k>B&&(B=k);return Math.max(0,B)},x=(g,p)=>{if(!Array.isArray(g)||g.length===0||p<=0)return[];const k=[];for(let B=0;B<g.length;B+=p){const v=Math.min(B+p,g.length),A=g.slice(B,v).reduce((l,P)=>l+Number(P||0),0);k.push(A)}return k},d=g=>Array.isArray(g)?g.map(p=>Array.isArray(p)?[Number(p[0]),Number(p[1])]:p&&typeof p=="object"?[Number(p.time),Number(p.value)]:null).filter(p=>!!p&&Number.isFinite(p[0])&&p[0]>=0):[],L=(g,p,k,B,v)=>{if(!g.length||B<=0)return[];const A=Math.max(B*5e3,v||0),l=n=>n.reduce((ee,b)=>b>=0&&b<=A+2e3?ee+1:ee,0),P=g.map(n=>Number(n||0)).filter(n=>Number.isFinite(n)&&n>=0);if(!P.length)return[];const q=[P],s=P.reduce((n,ee)=>Math.max(n,ee),0),u=P.reduce((n,ee)=>Math.min(n,ee),Number.POSITIVE_INFINITY);s>A*20&&q.push(P.map(n=>n/1e3)),s<=A*2&&u>=0&&s>0&&s<Math.max(120,B*5+10)&&q.push(P.map(n=>n*1e3));let O=P,J=0,f=-1;return q.forEach(n=>{const ee=n.reduce((h,H)=>Math.min(h,H),Number.POSITIVE_INFINITY),b=new Set([0,...p,...k]);if(Number.isFinite(ee)&&A>0&&ee>A){const h=Math.floor(ee/A)*A;b.add(h),b.add(Math.max(0,h-A))}b.forEach(h=>{const H=n.map(U=>U-h),j=l(H);j>f&&(f=j,J=h,O=n)})}),O.map(n=>n-J).filter(n=>Number.isFinite(n)&&n>=0)},$=(g,p,k,B,v)=>{const A=L(g,p,k,B,v);return Array.from(new Set(A.map(l=>Math.floor(l/5e3)).filter(l=>Number.isFinite(l)&&l>=0&&l<B)))};y.map(g=>({log:g,ts:Oe(g==null?void 0:g.details,g)})).sort((g,p)=>g.ts-p.ts).forEach(({log:g},p)=>{const k=g==null?void 0:g.details;if(!k)return;const B=e(k.fightName||g.fightName||`Fight ${p+1}`),v=ct(k,g),A=o(B,String(v||"")),l={},q=(Array.isArray(k.players)?k.players:[]).filter(w=>!(w!=null&&w.notInSquad)),s=q.flatMap(w=>{const W=w==null?void 0:w.combatReplayData;return Array.isArray(W)?W.map(V=>Number(V==null?void 0:V.start)):[Number(W==null?void 0:W.start)]}).filter(w=>Number.isFinite(w)&&w>=0),u=q.flatMap(w=>{const W=w==null?void 0:w.combatReplayData;return(Array.isArray(W)?W:W?[W]:[]).flatMap(ne=>d(ne==null?void 0:ne.down).map(([ie])=>Number(ie||0)))}),O=q.flatMap(w=>{const W=w==null?void 0:w.combatReplayData;return(Array.isArray(W)?W:W?[W]:[]).flatMap(ne=>d(ne==null?void 0:ne.dead).map(([ie])=>Number(ie||0)))}),J=new Map,f=new Map,n=new Map;(Array.isArray(k.targets)?k.targets:[]).forEach((w,W)=>{if(!w||w.isFake||!w.enemyPlayer)return;const V=tt((w==null?void 0:w.profession)||(w==null?void 0:w.name)||(w==null?void 0:w.id))||"Unknown";n.set(V,(n.get(V)||0)+1);const ne=f.get(V)||new Map;Array.isArray(w==null?void 0:w.totalDamageDist)&&w.totalDamageDist.forEach(Me=>{Array.isArray(Me)&&Me.forEach(Re=>{if(!Re||typeof Re!="object"||Re.indirectDamage)return;const qe=Number(Re.totalDamage||0);if(!Number.isFinite(qe)||qe<=0)return;const ve=Number(Re.connectedHits||Re.hits||0),Xe=_(Re.id,k),_e=Xe.name,Je=ne.get(_e)||{skillName:_e,damage:0,hits:0,icon:Xe.icon};Je.damage+=qe,Je.hits+=Number.isFinite(ve)?ve:0,!Je.icon&&Xe.icon&&(Je.icon=Xe.icon),ne.set(_e,Je)})}),f.set(V,ne);const ie=K(q.map(Me=>a(Me,W))),le=ie.length>0?Z(ie):F(w),ke=C(w,k);let Ae=J.get(V);Ae||(Ae={perSecond:[],hit:0,skillName:""},J.set(V,Ae)),le.length>Ae.perSecond.length&&(Ae.perSecond.length=le.length);for(let Me=0;Me<le.length;Me+=1)Ae.perSecond[Me]=Number(Ae.perSecond[Me]||0)+Number(le[Me]||0);const Le=Number(ke.peak||0);Le>Ae.hit&&(Ae.hit=Le,Ae.skillName=ke.skillName||"Unknown Skill")});const b=Array.from(J.values()).some(w=>Array.isArray(w.perSecond)&&w.perSecond.some(W=>Number(W||0)>0));if(J.size===0||!b){const w=K(q.map(V=>{const ne=te(V==null?void 0:V.powerDamageTaken1S);return Z(ne)})),W=Array.from(n.values()).reduce((V,ne)=>V+Number(ne||0),0);w.length>0&&W>0&&n.forEach((V,ne)=>{const ie=Number(V||0)/W,le=w.map(Ae=>Number(Ae||0)*ie),ke=J.get(ne);J.set(ne,{perSecond:le,hit:Number((ke==null?void 0:ke.hit)||0),skillName:String((ke==null?void 0:ke.skillName)||"")})})}J.forEach((w,W)=>{var Xe;const V=W,ne=Number(w.hit||0),ie=Number(c(w.perSecond,1)||0),le=Number(c(w.perSecond,5)||0),ke=Number(c(w.perSecond,30)||0),Ae=Math.max(0,Math.ceil(Number((k==null?void 0:k.durationMS)||0)/5e3)),Le=Math.max(0,Math.ceil(w.perSecond.length/5)),Me=Math.max(Ae,Le),Re=x(w.perSecond,5),qe=Array.from({length:Me},(_e,Je)=>Number(Re[Je]||0));l[V]={hit:ne,burst1s:ie,burst5s:le,burst30s:ke,skillName:w.skillName||"Unknown Skill",buckets5s:qe,downIndices5s:$(u,[],s,Me,Number((k==null?void 0:k.durationMS)||0)),deathIndices5s:$(O,[],s,Me,Number((k==null?void 0:k.durationMS)||0)),skillRows:Array.from(((Xe=f.get(W))==null?void 0:Xe.values())||[]).sort((_e,Je)=>Je.damage-_e.damage).slice(0,50)};const ve=r.get(V)||{key:V,account:W,displayName:W,characterName:"",profession:W,professionList:[W],logs:0,peakHit:0,peak1s:0,peak5s:0,peak30s:0,peakFightLabel:"",peakSkillName:""};ve.logs+=1,ne>ve.peakHit&&(ve.peakHit=ne,ve.peakFightLabel=A,ve.peakSkillName=w.skillName||"Unknown Skill"),ie>ve.peak1s&&(ve.peak1s=ie),le>ve.peak5s&&(ve.peak5s=le),ke>ve.peak30s&&(ve.peak30s=ke),r.set(V,ve)});const h=Object.values(l).reduce((w,W)=>Math.max(w,Number((W==null?void 0:W.hit)||0)),0),H=Object.values(l).reduce((w,W)=>Math.max(w,Number((W==null?void 0:W.burst1s)||0)),0),j=Object.values(l).reduce((w,W)=>Math.max(w,Number((W==null?void 0:W.burst5s)||0)),0),U=Object.values(l).reduce((w,W)=>Math.max(w,Number((W==null?void 0:W.burst30s)||0)),0);M.push({id:g.filePath||g.id||`fight-${p+1}`,shortLabel:`F${p+1}`,fullLabel:A,timestamp:Oe(k,g),values:l,maxHit:h,max1s:H,max5s:j,max30s:U})});const X=Array.from(r.values()).sort((g,p)=>p.peakHit!==g.peakHit?p.peakHit-g.peakHit:g.displayName.localeCompare(p.displayName));return{fights:M,players:X}})(),ni=Array.from(Ke.entries()).map(([e,t])=>{const o=je.get(e)||{},M=Array.from(t.values()).map(r=>{var c,x;const _=Array.from(r.professions||[]).filter(d=>d&&d!=="Unknown");let C=r.profession||"Unknown";if(_.length>0){C=_[0];let d=((c=r.professionTimeMs)==null?void 0:c[C])||0;_.forEach(L=>{var X;const $=((X=r.professionTimeMs)==null?void 0:X[L])||0;$>d&&(d=$,C=L)})}const Z=r.durationMs||0,K=r.totalMs/1e3,te=Z>0?r.totalMs/Z:0,F=((x=me.get(r.account))==null?void 0:x.supportActiveMs)||Z,a=F>0?r.uptimeMs/F:0;return{account:r.account,profession:C,professionList:_,total:K,perSecond:te,uptimePerSecond:a,duration:Z/1e3}}).filter(r=>r.total>0||r.perSecond>0);return{id:e,name:o.name||e,icon:o.icon,rows:M}}).filter(e=>e.rows.length>0),si=Array.from(He.values()).map(e=>{const t=Array.from(e.skills.values()).sort((M,r)=>r.damage-M.damage);return{key:e.key,account:e.account,displayName:e.displayName,profession:e.profession,professionList:e.professionList,totalFightMs:e.totalFightMs,skills:t}}).sort((e,t)=>e.displayName.localeCompare(t.displayName));return{total:oe,wins:we,losses:Ie,avgSquadSize:ws,avgEnemies:Ts,squadKDR:Fs,enemyKDR:Bs,totalSquadKills:D,totalSquadDeaths:Qe,totalEnemyKills:fe,totalEnemyDeaths:ce,leaderboards:Pe,...Ls,outgoingConditionSummary:Object.values(ze).sort((e,t)=>t.damage-e.damage),incomingConditionSummary:Object.values(Ge).sort((e,t)=>t.damage-e.damage),outgoingConditionPlayers:Array.from(me.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,conditions:e.outgoingConditions})),incomingConditionPlayers:Array.from(me.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,conditions:e.incomingConditions})),topSkills:Ps,topIncomingSkills:qs,topSkillsByDamage:In,topSkillsByDownContribution:xn,playerSkillBreakdowns:si,topSkillsMetric:de,mapData:Hs,timelineData:Vs,boonTables:js,boonTimeline:Ws,boonUptimeTimeline:zs,offensePlayers:Array.from(me.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,offenseTotals:e.offenseTotals,offenseRateWeights:e.offenseRateWeights,totalFightMs:e.totalFightMs})),defensePlayers:Array.from(me.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,defenseTotals:e.defenseTotals,activeMs:e.defenseActiveMs,minionDamageTakenByMinion:e.defenseMinionDamageTaken})),damageMitigationPlayers:vs,damageMitigationMinions:Es,supportPlayers:Array.from(me.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,supportTotals:e.supportTotals,activeMs:e.supportActiveMs})),healingPlayers:Array.from(me.values()).map(e=>({account:e.account,profession:e.profession,professionList:e.professionList,healingTotals:e.healingTotals,activeMs:e.healingActiveMs})),mvp:Vt,silver:Bn,bronze:vn,squadClassData:Ks,enemyClassData:Js,fightBreakdown:Ys,fightDiffMode:Qs,attendanceData:Xs,squadCompByFight:Zs,spikeDamage:ei,incomingStrikeDamage:ti,specialTables:ni,topStatsPerSecond:at,topStatsLeaderboardsPerSecond:ot,avgMvpScore:En}})(),$e=(()=>{const Q=new Map,se=new Map,de=[],oe=new Map,we=new Map;y.forEach(re=>{const Ne=re.details;if(!Ne)return;const Qe=Ne.skillMap||{},D=Ne.fightName||"Log",ce=Oe(Ne,re)||Date.now(),fe={id:re.filePath||re.id||D,label:D,timestamp:ce,skillEntries:{},playerActiveSeconds:{},durationSeconds:Ne.durationMS?Ne.durationMS/1e3:0};(Ne.players||[]).forEach(De=>{if(De.notInSquad)return;const me=De.account||De.name||"Unknown",Ue=De.profession||"Unknown",ge=`${me}|${Ue}`;let Ce=se.get(ge);Ce||(Ce={key:ge,account:me,displayName:me,profession:Ue,professionList:[Ue],logs:0,totalActiveSeconds:0,skillTotals:{}},se.set(ge,Ce)),Ce.logs++;const He=(Array.isArray(De.activeTimes)?De.activeTimes[0]:0)/1e3;Ce.totalActiveSeconds=(Ce.totalActiveSeconds||0)+He,fe.playerActiveSeconds[ge]=He,(De.rotation||[]).forEach(ze=>{var Et,It,xt;if(!(ze!=null&&ze.id))return;const Ge=((Et=ze.skills)==null?void 0:Et.length)||0;if(Ge<=0)return;const xe=`s${ze.id}`,je=((It=Qe[xe])==null?void 0:It.name)||`Skill ${ze.id}`,Ke=(xt=Qe[xe])==null?void 0:xt.icon;Ce.skillTotals[xe]=(Ce.skillTotals[xe]||0)+Ge,Q.set(xe,(Q.get(xe)||0)+Ge),oe.set(xe,je),Ke&&!we.has(xe)&&we.set(xe,Ke),fe.skillEntries[xe]||(fe.skillEntries[xe]={name:je,icon:Ke,players:{}}),!fe.skillEntries[xe].icon&&Ke&&(fe.skillEntries[xe].icon=Ke),fe.skillEntries[xe].players[ge]=(fe.skillEntries[xe].players[ge]||0)+Ge})}),de.push(fe)});const Ie=Array.from(Q.entries()).map(([re,Ne])=>({id:re,name:oe.get(re)||re,total:Ne,icon:we.get(re)})).sort((re,Ne)=>Ne.total-re.total);return{logRecords:de,players:Array.from(se.values()),skillOptions:Ie,resUtilitySkills:[]}})();return{validLogs:y,stats:We,skillUsageData:$e}},ht=(i,m)=>{const S={};return m.forEach(z=>{i&&Object.prototype.hasOwnProperty.call(i,z)&&(S[z]=i[z])}),S},dn=i=>!!(i&&i.__statsPruned===!0),gn=(i,m)=>{if(!i||typeof i!="object")return i;const S={};return Object.entries(i).forEach(([z,G])=>{if(!G||typeof G!="object")return;const R={};typeof G.name=="string"&&(R.name=G.name),typeof G.icon=="string"&&(R.icon=G.icon),m!=null&&m.includeClassification&&typeof G.classification=="string"&&(R.classification=G.classification),m!=null&&m.includeStacking&&(typeof G.stacking=="boolean"?R.stacking=G.stacking:typeof G.stacking=="number"&&(R.stacking=!!G.stacking)),Object.keys(R).length>0&&(S[z]=R)}),S},bn=i=>{var S;const m=(S=i==null?void 0:i.statsAll)==null?void 0:S[0];return!m||typeof m!="object"?!1:m.distToCom!==void 0&&m.distToCom!=="Infinity"||m.stackDist!==void 0},hs=(i,m)=>{const S=z=>{if(!z||typeof z!="object")return null;const G=ht(z,["start","down","dead"]);return m&&Array.isArray(z.positions)&&(G.positions=z.positions),G};return Array.isArray(i)?i.map(z=>S(z)).filter(z=>!!z):i&&typeof i=="object"?S(i):i},pn=i=>{if(!i||typeof i!="object")return i;const m=ht(i,["players","targets","durationMS","uploadTime","timeStart","timeStartStd","timeEnd","timeEndStd","fightName","zone","mapName","map","location","permalink","uploadLinks","success","teamBreakdown","teamCounts","combatReplayMetaData","skillMap","buffMap","encounterDuration","player_damage_mitigation","player_minion_damage_mitigation","playerDamageMitigation","playerMinionDamageMitigation"]);if(m.skillMap=gn(m.skillMap,{includeClassification:!1,includeStacking:!1}),m.buffMap=gn(m.buffMap,{includeClassification:!0,includeStacking:!0}),Array.isArray(m.players)){const S=i.players,G=S.filter(R=>!(R!=null&&R.notInSquad)).some(R=>!(R!=null&&R.hasCommanderTag)&&!bn(R));m.players=S.map(R=>{const pe=ht(R,["name","display_name","character_name","profession","elite_spec","group","dpsAll","statsAll","dpsTargets","statsTargets","defenses","support","rotation","extHealingStats","extBarrierStats","squadBuffVolumes","selfBuffs","groupBuffs","squadBuffs","selfBuffsActive","groupBuffsActive","squadBuffsActive","buffUptimes","totalDamageDist","targetDamageDist","damage1S","targetDamage1S","powerDamageTaken1S","targetPowerDamage1S","totalDamageTaken","totalDamageTakenDist","hasCommanderTag","notInSquad","account","activeTimes","teamID","teamId","team","teamColor","team_color"]),y=Array.isArray(R==null?void 0:R.minions)?R.minions:[];pe.minions=y.map(he=>ht(he,["name","totalDamageTakenDist"]));const ae=G&&((R==null?void 0:R.hasCommanderTag)&&!(R!=null&&R.notInSquad)||!(R!=null&&R.notInSquad)&&!bn(R));return pe.combatReplayData=hs(R==null?void 0:R.combatReplayData,ae),pe})}return Array.isArray(m.targets)&&(m.targets=m.targets.map(S=>ht(S,["id","name","isFake","dpsAll","statsAll","defenses","totalHealth","healthPercentBurned","enemyPlayer","totalDamageDist","totalDamageTaken","totalDamageTakenDist","damageTaken","powerDamage1S","damage1S","profession","teamID","teamId","team","teamColor","team_color"]))),m},ks=i=>{if(!i||typeof i!="object"||dn(i))return i;const m={...i};return i.details?m.details=pn(i.details):m.details=pn(i),m.__statsPruned=!0,m};let Ze=null,hn=0,Ht=0,Bt=null,vt=0,jt=0;const Ns=i=>typeof(i==null?void 0:i.token)=="number"&&i.token!==Ht,Ss=i=>{const m=i==null?void 0:i.stats;if(!m||typeof m!="object")return{spikeSkillRowsRemoved:0,incomingSkillRowsRemoved:0,playerSkillMapsRemoved:0};const S=y=>{let ae=0;return(Array.isArray(y==null?void 0:y.fights)?y.fights:[]).forEach(Ve=>{if(!Ve||typeof Ve!="object")return;const We=Ve.values;!We||typeof We!="object"||Object.values(We).forEach($e=>{!$e||typeof $e!="object"||Array.isArray($e.skillRows)&&(delete $e.skillRows,ae+=1)})}),ae},z=S(m.spikeDamage),G=S(m.incomingStrikeDamage);let R=0;return(Array.isArray(m.playerSkillBreakdowns)?m.playerSkillBreakdowns:[]).forEach(y=>{!y||typeof y!="object"||y.skillMap&&typeof y.skillMap=="object"&&(delete y.skillMap,R+=1)}),{spikeSkillRowsRemoved:z,incomingSkillRowsRemoved:G,playerSkillMapsRemoved:R}},Ds=()=>{var pe,y;if(!Ze)return;hn+=1;const i=Bt;Bt=null;const m=performance.now(),S=ps({...Ze,includePlayerSkillMap:!1}),z=Ss(S),G=Math.max(0,performance.now()-m),R=S==null?void 0:S.stats;self.postMessage({type:"result",result:S,computeId:hn,logCount:Ze.logs.length,token:Ht,completedAt:Date.now(),flushId:i,diagnostics:{computeMs:G,logsInPayload:Ze.logs.length,expectedLogCount:vt,droppedLogMessages:jt,transferStripStats:z,counts:{playerSkillBreakdowns:Array.isArray(R==null?void 0:R.playerSkillBreakdowns)?R.playerSkillBreakdowns.length:0,spikeFights:Array.isArray((pe=R==null?void 0:R.spikeDamage)==null?void 0:pe.fights)?R.spikeDamage.fights.length:0,incomingStrikeFights:Array.isArray((y=R==null?void 0:R.incomingStrikeDamage)==null?void 0:y.fights)?R.incomingStrikeDamage.fights.length:0}}})};self.onmessage=i=>{var S,z,G,R;const m=i.data;if((m==null?void 0:m.type)==="reset"){Ze={logs:[]},typeof m.token=="number"&&(Ht=m.token),vt=Math.max(0,Number(m.totalLogs||0)),jt=0,Bt=null;return}if(!Ns(m)){if((m==null?void 0:m.type)==="settings"){Ze={logs:(Ze==null?void 0:Ze.logs)||[],precomputedStats:(S=m.payload)==null?void 0:S.precomputedStats,mvpWeights:(z=m.payload)==null?void 0:z.mvpWeights,statsViewSettings:(G=m.payload)==null?void 0:G.statsViewSettings,disruptionMethod:(R=m.payload)==null?void 0:R.disruptionMethod};return}if((m==null?void 0:m.type)==="log"){if(Ze||(Ze={logs:[]}),vt>0&&Ze.logs.length>=vt){jt+=1;return}Ze.logs.push(dn(m.payload)?m.payload:ks(m.payload));return}(m==null?void 0:m.type)==="flush"&&(typeof m.flushId=="number"&&(Bt=m.flushId),Ds())}}})();
